generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  DOCTOR
  NURSE
  RECEPTIONIST
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum BloodType {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
  UNKNOWN
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  phone         String?
  specialty     String?
  licenseNumber String?
  role          Role      @default(RECEPTIONIST)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  departmentId  String?

  // Relations
  medicalHistories MedicalHistory[]
  uploadedDocuments PatientDocument[]
  appointmentsCreated Appointment[] @relation("AppointmentCreatedBy")
  appointmentsAsProvider Appointment[] @relation("AppointmentProvider")
  encountersCreated Encounter[] @relation("EncounterCreatedBy")
  encountersAsProvider Encounter[] @relation("EncounterProvider")
  department Department? @relation("DepartmentUsers", fields: [departmentId], references: [id])
  dialysisSessions DialysisSession[]
  dialysisPrescriptions DialysisPrescription[]
  dialysisSchedules DialysisSchedule[]
  cardiologyVisits CardiologyVisit[]
  cardiologyEcgs CardiologyEcg[]
  cardiologyEchos CardiologyEcho[]
  cardiologyStressTests CardiologyStressTest[]
  cardiologyProcedures CardiologyProcedure[]
  cardiologyDevices CardiologyDevice[]
  cardiologyMedicationOrders CardiologyMedicationOrder[]
  cardiologyElectrophysiologyStudies CardiologyElectrophysiology[]
  cardiologyHeartFailureAssessments CardiologyHeartFailure[]
  nephrologyVisits NephrologyVisit[]
  nephrologyImagingStudies NephrologyImaging[]
  nephrologyBiopsies NephrologyBiopsy[]
  nephrologyMedicationOrders NephrologyMedicationOrder[]
  neurologyVisits NeurologyVisit[]
  clinicalOrders ClinicalOrder[]
  medicationOrders MedicationOrder[]
  medicationAdministrations MedicationAdministration[]
  invoicesCreated Invoice[]
  paymentsReceived Payment[]
  admissions Admission[]
  surgeriesTeamMember SurgeryTeamMember[]
  surgeryChecklists SurgeryChecklist[]
  operativeReports OperativeReport[]
  
  // Neurology
  neurologyEegs NeurologyEeg[]
  neurologyEmgs NeurologyEmg[]
  neurologyImagingStudies NeurologyImaging[]
  neurologyStrokes NeurologyStroke[]
  neurologySeizures NeurologySeizure[]
  neurologyCognitiveAssessments NeurologyCognitiveAssessment[]
  
  // Oncology
  oncologyChemotherapy OncologyChemotherapy[]
  oncologyRadiation OncologyRadiation[]
  oncologyStaging OncologyStaging[]
  oncologyTumorBoards OncologyTumorBoard[]
  
  // Orthopedics
  orthopedicFractures OrthopedicFracture[]
  orthopedicJointReplacements OrthopedicJointReplacement[]
  orthopedicPhysicalTherapy OrthopedicPhysicalTherapy[]
  
  // Pulmonology
  pulmonologySpirometry PulmonologySpirometry[]
  pulmonologySleepStudies PulmonologySleepStudy[]
  pulmonologyBronchoscopies PulmonologyBronchoscopy[]
  
  // Gastroenterology
  gastroEndoscopies GastroEndoscopy[]
  gastroColonoscopies GastroColonoscopy[]
  
  // Endocrinology
  endoDiabetes EndoDiabetes[]
  endoInsulin EndoInsulin[]
  endoThyroids EndoThyroid[]
  
  // OBGYN
  obgynPregnancies ObgynPregnancy[]
  obgynDeliveries ObgynDelivery[]
  
  // Pediatrics
  pedsGrowthCharts PedsGrowthChart[]
  pedsVaccinations PedsVaccination[]
  pedsDevelopmental PedsDevelopmental[]
  
  // Psychiatry
  psychiatryAssessments PsychiatryAssessment[]
  psychiatryTherapy PsychiatryTherapy[]
  psychiatryMedication PsychiatryMedication[]
  
  // Dermatology
  dermLesions DermLesion[]
  dermBiopsies DermBiopsy[]
  
  // Ophthalmology
  ophthExams OphthExam[]
  ophthVisualAcuity OphthVisualAcuity[]
  ophthFundus OphthFundus[]
  
  // ENT
  entAudiometry EntAudiometry[]
  entNasalEndoscopy EntNasalEndoscopy[]

  // LIS
  specimensCollected Specimen[] @relation(name: "SpecimenCollectedBy")
  specimensReceived Specimen[] @relation(name: "SpecimenReceivedBy")
  labWorkOrdersOrdered LabWorkOrder[] @relation(name: "LabWorkOrderOrderedBy")
  labWorkOrdersVerified LabWorkOrder[] @relation(name: "LabWorkOrderVerifiedBy")
  labWorkOrdersCancelled LabWorkOrder[] @relation(name: "LabWorkOrderCancelledBy")
  labResultsEntered LabResult[] @relation(name: "LabResultTechnician")
  labResultsReviewed LabResult[] @relation(name: "LabResultReviewer")
  qcResultsEntered QCResult[] @relation(name: "QCResultTechnician")
  qcResultsReviewed QCResult[] @relation(name: "QCResultReviewer")

  // Radiology/PACS
  imagingStudiesReferred ImagingStudy[] @relation(name: "ReferringPhysician")
  imagingStudiesAsRadiologist ImagingStudy[] @relation(name: "Radiologist")
  imagingStudiesAsTechnician ImagingStudy[] @relation(name: "Technician")
  radiologistReports RadiologistReport[] @relation(name: "ReportRadiologist")
  radiologistReportsVerified RadiologistReport[] @relation(name: "VerifyingRadiologist")

  // Emergency Department
  edVisitsAsTriageNurse EDVisit[] @relation(name: "EDTriageNurse")
  edVisitsAsProvider EDVisit[] @relation(name: "EDProvider")
  edTriages EDTriage[] @relation(name: "TriageNurse")
  edProceduresPerformed EDProcedure[] @relation(name: "EDProcedureProvider")
  edProceduresAssisted EDProcedure[] @relation(name: "EDProcedureAssistant")
  edFlows EDFlow[] @relation(name: "EDFlowProvider")

  // ICU / Critical Care
  icuAdmissionsAdmitting IcuAdmission[] @relation(name: "IcuAdmittingProvider")
  icuAdmissionsDischarging IcuAdmission[] @relation(name: "IcuDischargeProvider")
  icuVitalSignsRecorded IcuVitalSign[] @relation(name: "IcuVitalsRecorder")
  ventilatorSettingsRecorded VentilatorSetting[] @relation(name: "VentSettingsRecorder")
  sedationAssessmentsPerformed SedationAssessment[] @relation(name: "SedationAssessor")
  linesTubesInserted LinesTubesDrains[] @relation(name: "LineInsertedBy")
  linesTubesRemoved LinesTubesDrains[] @relation(name: "LineRemovedBy")
  fluidBalancesRecorded FluidBalance[] @relation(name: "FluidBalanceRecorder")
  icuFlowsheetsRecorded IcuFlowsheet[] @relation(name: "FlowsheetRecorder")
  icuDailyGoalsCreated IcuDailyGoal[] @relation(name: "DailyGoalCreator")

  // Blood Bank
  bloodDonationsProcessed BloodDonation[] @relation(name: "BloodProcessedBy")
  crossMatchesPerformed CrossMatch[] @relation(name: "CrossMatchTester")
  transfusionsOrdered BloodTransfusion[] @relation(name: "TransfusionOrderedBy")
  transfusionsStarted BloodTransfusion[] @relation(name: "TransfusionStartedBy")
  transfusionsCompleted BloodTransfusion[] @relation(name: "TransfusionCompletedBy")

  // Inventory
  inventoryTransactionsPerformed InventoryTransaction[] @relation(name: "InventoryTransactionPerformer")
  purchaseOrdersRequested PurchaseOrder[] @relation(name: "PORequestedBy")
  purchaseOrdersApproved PurchaseOrder[] @relation(name: "POApprovedBy")
  requisitionsRequested Requisition[] @relation(name: "RequisitionRequestedBy")
  requisitionsApproved Requisition[] @relation(name: "RequisitionApprovedBy")
  requisitionsFulfilled Requisition[] @relation(name: "RequisitionFulfilledBy")
  aiChatSessions AiChatSession[]

  @@map("users")
}

model Patient {
  id                      String    @id @default(cuid())
  mrn                     String    @unique // Medical Record Number
  
  // Demographics
  firstName               String
  lastName                String
  dateOfBirth             DateTime
  gender                  Gender
  bloodType               BloodType @default(UNKNOWN)
  
  // Contact Information
  email                   String?
  phone                   String
  address                 String?   @db.Text
  city                    String?
  country                 String?
  
  // Emergency Contact
  emergencyContactName    String?
  emergencyContactPhone   String?
  emergencyContactRelation String?
  
  // Medical Information
  allergies               Json      @default("[]")
  chronicConditions       Json      @default("[]")
  
  // Status
  isActive                Boolean   @default(true)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  // Relations
  medicalHistories        MedicalHistory[]
  documents               PatientDocument[]
  appointments            Appointment[]
  encounters              Encounter[]
  dialysisSessions        DialysisSession[]
  dialysisPrescriptions   DialysisPrescription[]
  dialysisSchedules       DialysisSchedule[]
  dialysisLabResults       DialysisLabResult[]
  dialysisMedicationOrders DialysisMedicationOrder[]
  cardiologyVisits         CardiologyVisit[]
  cardiologyEcgs           CardiologyEcg[]
  cardiologyEchos          CardiologyEcho[]
  cardiologyStressTests    CardiologyStressTest[]
  cardiologyProcedures     CardiologyProcedure[]
  cardiologyDevices        CardiologyDevice[]
  cardiologyMedicationOrders CardiologyMedicationOrder[]
  cardiologyLabResults       CardiologyLabResult[]
  cardiologyElectrophysiologyStudies CardiologyElectrophysiology[]
  cardiologyHeartFailureAssessments CardiologyHeartFailure[]
  nephrologyVisits           NephrologyVisit[]
  nephrologyLabResults       NephrologyLabResult[]
  nephrologyImagingStudies   NephrologyImaging[]
  nephrologyBiopsies         NephrologyBiopsy[]
  nephrologyMedicationOrders NephrologyMedicationOrder[]
  neurologyVisits            NeurologyVisit[]
  neurologyEegs              NeurologyEeg[]
  neurologyEmgs              NeurologyEmg[]
  neurologyImaging           NeurologyImaging[]
  neurologyStrokes           NeurologyStroke[]
  neurologySeizures          NeurologySeizure[]
  neurologyCognitiveAssessments NeurologyCognitiveAssessment[]
  
  // Oncology
  oncologyChemotherapy       OncologyChemotherapy[]
  oncologyRadiation          OncologyRadiation[]
  oncologyStaging            OncologyStaging[]
  oncologyTumorBoards        OncologyTumorBoard[]
  
  // Orthopedics
  orthopedicFractures        OrthopedicFracture[]
  orthopedicJointReplacements OrthopedicJointReplacement[]
  orthopedicPhysicalTherapy  OrthopedicPhysicalTherapy[]
  
  // Pulmonology
  pulmonologySpirometry      PulmonologySpirometry[]
  pulmonologySleepStudies    PulmonologySleepStudy[]
  pulmonologyBronchoscopies  PulmonologyBronchoscopy[]
  
  // Gastroenterology
  gastroEndoscopies          GastroEndoscopy[]
  gastroColonoscopies        GastroColonoscopy[]
  gastroLiverFunctions       GastroLiverFunction[]
  
  // Endocrinology
  endoDiabetes               EndoDiabetes[]
  endoInsulin                EndoInsulin[]
  endoThyroids               EndoThyroid[]
  
  // OBGYN
  obgynPregnancies           ObgynPregnancy[]
  obgynDeliveries            ObgynDelivery[]
  
  // Pediatrics
  pedsGrowthCharts           PedsGrowthChart[]
  pedsVaccinations           PedsVaccination[]
  pedsDevelopmental          PedsDevelopmental[]
  
  // Psychiatry
  psychiatryAssessments      PsychiatryAssessment[]
  psychiatryTherapy          PsychiatryTherapy[]
  psychiatryMedication       PsychiatryMedication[]
  
  // Dermatology
  dermLesions                DermLesion[]
  dermBiopsies               DermBiopsy[]
  
  // Ophthalmology
  ophthExams                 OphthExam[]
  ophthVisualAcuity          OphthVisualAcuity[]
  ophthFundus                OphthFundus[]
  
  // ENT
  entAudiometry              EntAudiometry[]
  entNasalEndoscopy          EntNasalEndoscopy[]

  // LIS
  specimens                  Specimen[]
  labWorkOrders              LabWorkOrder[]
  labResults                 LabResult[]
  
  clinicalOrders             ClinicalOrder[]
  clinicalResults            ClinicalResult[]
  medicationOrders           MedicationOrder[]
  medicationAdministrations  MedicationAdministration[]
  invoices                   Invoice[]
  payments                   Payment[]
  claims                     Claim[]
  admissions                 Admission[]
  surgeries                  Surgery[]
  imagingStudies             ImagingStudy[]
  edVisits                   EDVisit[]
  icuAdmissions              IcuAdmission[]
  
  // Blood Bank
  bloodProductsReserved      BloodProduct[] @relation(name: "BloodReservedFor")
  crossMatches               CrossMatch[]
  bloodTransfusions          BloodTransfusion[]

  @@map("patients")
}

model MedicalHistory {
  id          String    @id @default(cuid())
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  diagnosis   String    @db.Text
  treatment   String?   @db.Text
  notes       String?   @db.Text
  visitDate   DateTime
  
  doctorId    String
  doctor      User      @relation(fields: [doctorId], references: [id])
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([patientId])
  @@index([doctorId])
  @@map("medical_histories")
}

model PatientDocument {
  id          String    @id @default(cuid())
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  fileName    String
  fileType    String
  filePath    String
  fileSize    Int
  
  uploadedById String
  uploadedBy   User     @relation(fields: [uploadedById], references: [id])
  
  uploadedAt  DateTime  @default(now())

  @@index([patientId])
  @@index([uploadedById])
  @@map("patient_documents")
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  CHECKED_IN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum DialysisStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DialysisStationStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  OUT_OF_SERVICE
}

enum DialysisScheduleRecurrence {
  NONE
  DAILY
  WEEKLY
  MONTHLY
}

enum DialysisMedicationRoute {
  IV
  PO
  IM
  SC
  OTHER
}

enum CardiologyVisitStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CardiologyTestStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CardiologyProcedureStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CardiologyDeviceStatus {
  ACTIVE
  INACTIVE
  REMOVED
}

enum CardiologyMedicationRoute {
  IV
  PO
  IM
  SC
  SL
  OTHER
}

enum NephrologyVisitStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NephrologyTestStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NeurologyVisitStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum EncounterStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OrderType {
  LAB
  IMAGING
  MEDICATION
  PROCEDURE
  OTHER
}

enum OrderStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OrderPriority {
  ROUTINE
  URGENT
  STAT
}

enum ResultStatus {
  PENDING
  FINAL
  AMENDED
}

enum ResultFlag {
  NORMAL
  ABNORMAL
  CRITICAL
}

enum MedicationOrderStatus {
  ACTIVE
  ON_HOLD
  COMPLETED
  DISCONTINUED
}

enum MedicationRoute {
  IV
  PO
  IM
  SC
  SL
  INHALATION
  TOPICAL
  OTHER
}

enum MedicationAdministrationStatus {
  GIVEN
  HELD
  REFUSED
  MISSED
}

enum InvoiceStatus {
  DRAFT
  ISSUED
  SUBMITTED
  PARTIAL
  PAID
  DENIED
  VOID
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
  CHECK
  OTHER
}

enum ClaimStatus {
  DRAFT
  SUBMITTED
  ACCEPTED
  DENIED
  PAID
}

enum AdmissionStatus {
  ADMITTED
  TRANSFERRED
  DISCHARGED
  CANCELLED
}

enum BedStatus {
  AVAILABLE
  OCCUPIED
  CLEANING
  MAINTENANCE
}

enum NephrologyProcedureStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NephrologyMedicationRoute {
  IV
  PO
  IM
  SC
  SL
  OTHER
}

enum CkdStage {
  STAGE_1
  STAGE_2
  STAGE_3A
  STAGE_3B
  STAGE_4
  STAGE_5
  ESRD
}

enum NephrologyImagingModality {
  ULTRASOUND
  CT
  MRI
  XRAY
  NUCLEAR
  OTHER
}

enum SurgeryStatus {
  REQUESTED
  SCHEDULED
  PRE_OP
  IN_PROGRESS
  RECOVERY
  COMPLETED
  CANCELLED
}

enum SurgeryPriority {
  ELECTIVE
  URGENT
  EMERGENCY
}

enum AnesthesiaType {
  GENERAL
  REGIONAL_SPINAL
  REGIONAL_EPIDURAL
  REGIONAL_NERVE_BLOCK
  MAC
  LOCAL
  TOPICAL
}

enum AsaPhysicalStatus {
  I
  II
  III
  IV
  V
  VI
  E
}

enum SurgicalRole {
  LEAD_SURGEON
  ASSISTANT_SURGEON
  ANESTHESIOLOGIST
  ANESTHETIST_NURSE
  SCRUB_NURSE
  CIRCULATING_NURSE
  TECHNICIAN
}

enum WoundClass {
  CLEAN
  CLEAN_CONTAMINATED
  CONTAMINATED
  DIRTY_INFECTED
}

model Department {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  locations   Location[]
  users       User[]   @relation("DepartmentUsers")
  wards       Ward[]
  admissions  Admission[]

  @@map("departments")
}

model Specialty {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("specialties")
}

model Location {
  id           String    @id @default(cuid())
  name         String
  type         String?
  departmentId String?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  department   Department? @relation(fields: [departmentId], references: [id])
  appointments Appointment[]

  @@map("locations")
}

model VisitType {
  id              String   @id @default(cuid())
  name            String   @unique
  description     String?
  durationMinutes Int      @default(30)
  isTelehealth    Boolean  @default(false)
  color           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  appointments    Appointment[]

  @@map("visit_types")
}

model Appointment {
  id            String            @id @default(cuid())
  patientId     String
  providerId    String
  createdById   String
  visitTypeId   String?
  locationId    String?
  startTime     DateTime
  endTime       DateTime
  status        AppointmentStatus @default(SCHEDULED)
  reason        String?
  notes         String?
  cancellationReason String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  patient     Patient   @relation(fields: [patientId], references: [id])
  provider    User      @relation("AppointmentProvider", fields: [providerId], references: [id])
  createdBy   User      @relation("AppointmentCreatedBy", fields: [createdById], references: [id])
  visitType   VisitType? @relation(fields: [visitTypeId], references: [id])
  location    Location?  @relation(fields: [locationId], references: [id])
  encounter   Encounter?

  @@index([patientId])
  @@index([providerId])
  @@index([startTime])
  @@index([status])
  @@map("appointments")
}

model DialysisSession {
  id                     String         @id @default(cuid())
  patientId              String
  providerId             String
  status                 DialysisStatus @default(SCHEDULED)
  startTime              DateTime
  endTime                DateTime
  machineNumber          String?
  accessType             String?
  dialyzer               String?
  dialysate              String?
  bloodFlowRate          Int?
  dialysateFlowRate      Int?
  ultrafiltrationVolume  Float?
  weightPre              Float?
  weightPost             Float?
  notes                  String?        @db.Text
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt

  patient                Patient        @relation(fields: [patientId], references: [id])
  provider               User           @relation(fields: [providerId], references: [id])
  flowsheetEntries       DialysisFlowsheetEntry[]

  @@index([patientId])
  @@index([providerId])
  @@index([startTime])
  @@index([status])
  @@map("dialysis_sessions")
}

model DialysisPrescription {
  id                     String   @id @default(cuid())
  patientId              String
  providerId             String?
  dryWeight              Float?
  targetUltrafiltration  Float?
  durationMinutes        Int?
  dialyzer               String?
  dialysate              String?
  bloodFlowRate          Int?
  dialysateFlowRate      Int?
  accessType             String?
  frequency              String?
  isActive               Boolean  @default(true)
  notes                  String?  @db.Text
  startDate              DateTime?
  endDate                DateTime?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  patient                Patient  @relation(fields: [patientId], references: [id])
  provider               User?    @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([isActive])
  @@map("dialysis_prescriptions")
}

model DialysisFlowsheetEntry {
  id                     String   @id @default(cuid())
  sessionId              String
  recordedAt             DateTime
  bpSystolic             Int?
  bpDiastolic            Int?
  heartRate              Int?
  temperature            Float?
  oxygenSaturation       Int?
  bloodFlowRate          Int?
  dialysateFlowRate      Int?
  ultrafiltrationVolume  Float?
  arterialPressure       Int?
  venousPressure         Int?
  transmembranePressure  Int?
  alarms                 String?  @db.Text
  notes                  String?  @db.Text
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  session                DialysisSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([recordedAt])
  @@map("dialysis_flowsheet_entries")
}

model DialysisStation {
  id               String                @id @default(cuid())
  name             String
  room             String?
  machineNumber    String?
  status           DialysisStationStatus @default(AVAILABLE)
  lastServiceDate  DateTime?
  nextServiceDate  DateTime?
  notes            String?               @db.Text
  isActive         Boolean               @default(true)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt

  schedules        DialysisSchedule[]

  @@map("dialysis_stations")
}

model DialysisSchedule {
  id               String                     @id @default(cuid())
  patientId        String
  providerId       String?
  stationId        String?
  startTime        DateTime
  durationMinutes  Int
  recurrence       DialysisScheduleRecurrence @default(NONE)
  daysOfWeek       Json                       @default("[]")
  endDate          DateTime?
  isActive         Boolean                    @default(true)
  notes            String?                    @db.Text
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt

  patient          Patient                    @relation(fields: [patientId], references: [id])
  provider         User?                      @relation(fields: [providerId], references: [id])
  station          DialysisStation?           @relation(fields: [stationId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([stationId])
  @@index([startTime])
  @@map("dialysis_schedules")
}

model DialysisLabResult {
  id              String   @id @default(cuid())
  patientId       String
  collectedAt     DateTime
  ktv             Float?
  urr             Float?
  hemoglobin      Float?
  potassium       Float?
  sodium          Float?
  calcium         Float?
  phosphorus      Float?
  bicarbonate     Float?
  albumin         Float?
  creatinine      Float?
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  patient         Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([collectedAt])
  @@map("dialysis_lab_results")
}

model DialysisMedicationOrder {
  id                String                   @id @default(cuid())
  patientId         String
  medicationName    String
  dose              String?
  route             DialysisMedicationRoute?
  frequency         String?
  startDate         DateTime?
  endDate           DateTime?
  lastAdministeredAt DateTime?
  isActive          Boolean                  @default(true)
  notes             String?                  @db.Text
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt

  patient           Patient                  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([isActive])
  @@map("dialysis_medication_orders")
}

model CardiologyVisit {
  id           String                @id @default(cuid())
  patientId    String
  providerId   String
  status       CardiologyVisitStatus @default(SCHEDULED)
  visitDate    DateTime
  reason       String?               @db.Text
  symptoms     String?               @db.Text
  diagnosis    String?               @db.Text
  assessment   String?               @db.Text
  plan         String?               @db.Text
  notes        String?               @db.Text
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt

  patient      Patient               @relation(fields: [patientId], references: [id])
  provider     User                  @relation(fields: [providerId], references: [id])
  ecgs         CardiologyEcg[]
  echos        CardiologyEcho[]
  stressTests  CardiologyStressTest[]
  procedures   CardiologyProcedure[]
  electrophysiologyStudies CardiologyElectrophysiology[]
  heartFailureAssessments CardiologyHeartFailure[]

  @@index([patientId])
  @@index([providerId])
  @@index([visitDate])
  @@index([status])
  @@map("cardiology_visits")
}

model CardiologyEcg {
  id             String               @id @default(cuid())
  patientId      String
  providerId     String?
  visitId        String?
  status         CardiologyTestStatus @default(ORDERED)
  recordedAt     DateTime
  type           String?
  rhythm         String?
  heartRate      Int?
  prInterval     Int?
  qrsDuration    Int?
  qtInterval     Int?
  qtc            Int?
  interpretation String?              @db.Text
  notes          String?              @db.Text
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  patient        Patient              @relation(fields: [patientId], references: [id])
  provider       User?                @relation(fields: [providerId], references: [id])
  visit          CardiologyVisit?     @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([recordedAt])
  @@index([status])
  @@map("cardiology_ecgs")
}

model CardiologyEcho {
  id                 String               @id @default(cuid())
  patientId          String
  providerId         String?
  visitId            String?
  status             CardiologyTestStatus @default(ORDERED)
  performedAt        DateTime
  type               String?
  lvef               Float?
  lvEndDiastolicDia  Float?
  lvEndSystolicDia   Float?
  rvFunction         String?
  valveFindings      String?              @db.Text
  wallMotion         String?              @db.Text
  pericardialEffusion Boolean?
  summary            String?              @db.Text
  notes              String?              @db.Text
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt

  patient            Patient              @relation(fields: [patientId], references: [id])
  provider           User?                @relation(fields: [providerId], references: [id])
  visit              CardiologyVisit?     @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("cardiology_echos")
}

model CardiologyStressTest {
  id               String               @id @default(cuid())
  patientId        String
  providerId       String?
  visitId          String?
  status           CardiologyTestStatus @default(ORDERED)
  performedAt      DateTime
  type             String?
  protocol         String?
  durationMinutes  Int?
  mets             Float?
  maxHeartRate     Int?
  maxBpSystolic    Int?
  maxBpDiastolic   Int?
  symptoms         String?              @db.Text
  result           String?              @db.Text
  notes            String?              @db.Text
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt

  patient          Patient              @relation(fields: [patientId], references: [id])
  provider         User?                @relation(fields: [providerId], references: [id])
  visit            CardiologyVisit?     @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("cardiology_stress_tests")
}

model CardiologyProcedure {
  id             String                   @id @default(cuid())
  patientId      String
  providerId     String?
  visitId        String?
  status         CardiologyProcedureStatus @default(SCHEDULED)
  procedureDate  DateTime
  type           String?
  indication     String?                  @db.Text
  findings       String?                  @db.Text
  complications  String?                  @db.Text
  outcome        String?                  @db.Text
  notes          String?                  @db.Text
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt

  patient        Patient                  @relation(fields: [patientId], references: [id])
  provider       User?                    @relation(fields: [providerId], references: [id])
  visit          CardiologyVisit?         @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([procedureDate])
  @@index([status])
  @@map("cardiology_procedures")
}

model CardiologyDevice {
  id                   String                 @id @default(cuid())
  patientId            String
  providerId           String?
  deviceType           String
  manufacturer         String?
  model                String?
  serialNumber         String?
  implantDate          DateTime?
  status               CardiologyDeviceStatus @default(ACTIVE)
  lastInterrogationDate DateTime?
  nextFollowUpDate     DateTime?
  batteryStatus        String?
  settings             String?                @db.Text
  notes                String?                @db.Text
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt

  patient              Patient                @relation(fields: [patientId], references: [id])
  provider             User?                  @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([implantDate])
  @@index([status])
  @@map("cardiology_devices")
}

model CardiologyMedicationOrder {
  id                String                   @id @default(cuid())
  patientId         String
  providerId        String?
  medicationName    String
  dose              String?
  route             CardiologyMedicationRoute?
  frequency         String?
  startDate         DateTime?
  endDate           DateTime?
  lastAdministeredAt DateTime?
  isActive          Boolean                  @default(true)
  indication        String?                  @db.Text
  notes             String?                  @db.Text
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt

  patient           Patient                  @relation(fields: [patientId], references: [id])
  provider          User?                    @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([isActive])
  @@map("cardiology_medication_orders")
}

model CardiologyLabResult {
  id               String   @id @default(cuid())
  patientId        String
  collectedAt      DateTime
  troponin         Float?
  bnp              Float?
  ntProBnp         Float?
  ckmb             Float?
  totalCholesterol Float?
  ldl              Float?
  hdl              Float?
  triglycerides    Float?
  crp              Float?
  inr              Float?
  notes            String?  @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  patient          Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([collectedAt])
  @@map("cardiology_lab_results")
}

enum ElectrophysiologyProcedureType {
  PACEMAKER_IMPLANT
  ICD_IMPLANT
  CRT_IMPLANT
  ABLATION
  ELECTROPHYSIOLOGY_STUDY
  LOOP_RECORDER_IMPLANT
  LEAD_EXTRACTION
  OTHER
}

model CardiologyElectrophysiology {
  id               String                         @id @default(cuid())
  patientId        String
  providerId       String?
  visitId          String?
  status           CardiologyTestStatus           @default(ORDERED)
  performedAt      DateTime
  procedureType    ElectrophysiologyProcedureType
  indication       String?                        @db.Text
  arrhythmiaType   String?
  deviceType       String?
  manufacturer     String?
  model            String?
  serialNumber     String?
  implantDate      DateTime?
  ablationTarget  String?
  fluoroscopyTime Int?
  complications    String?                        @db.Text
  outcome          String?                        @db.Text
  followUpDate     DateTime?
  notes            String?                        @db.Text
  createdAt        DateTime                       @default(now())
  updatedAt        DateTime                       @updatedAt

  patient          Patient                        @relation(fields: [patientId], references: [id])
  provider         User?                          @relation(fields: [providerId], references: [id])
  visit            CardiologyVisit?               @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@index([procedureType])
  @@map("cardiology_electrophysiology")
}

enum HeartFailureStage {
  STAGE_A
  STAGE_B
  STAGE_C
  STAGE_D
}

enum NYHAClass {
  CLASS_I
  CLASS_II
  CLASS_III
  CLASS_IV
}

model CardiologyHeartFailure {
  id                 String                @id @default(cuid())
  patientId          String
  providerId         String?
  visitId            String?
  status             CardiologyTestStatus  @default(ORDERED)
  assessmentDate     DateTime
  etiology           String?               @db.Text
  nyhaClass          NYHAClass?
  heartFailureStage  HeartFailureStage?
  lvef               Float?
  symptoms           String?               @db.Text
  medications        String?               @db.Text
  mechanicalSupport   String?
  transplantStatus   String?
  implantableDevices String?               @db.Text
  rehospitalizations  Int?
  lastHospitalization DateTime?
  bnp                Float?
  ntProBnp           Float?
  assessment         String?               @db.Text
  plan               String?               @db.Text
  nextFollowUpDate   DateTime?
  notes              String?               @db.Text
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt

  patient            Patient               @relation(fields: [patientId], references: [id])
  provider           User?                 @relation(fields: [providerId], references: [id])
  visit              CardiologyVisit?      @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([assessmentDate])
  @@index([status])
  @@index([nyhaClass])
  @@index([heartFailureStage])
  @@map("cardiology_heart_failure")
}

model NephrologyVisit {
  id           String                 @id @default(cuid())
  patientId    String
  providerId   String
  status       NephrologyVisitStatus  @default(SCHEDULED)
  visitDate    DateTime
  reason       String?                @db.Text
  symptoms     String?                @db.Text
  ckdStage     CkdStage?
  egfr         Float?
  bpSystolic   Int?
  bpDiastolic  Int?
  diagnosis    String?                @db.Text
  assessment   String?                @db.Text
  plan         String?                @db.Text
  notes        String?                @db.Text
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  patient      Patient                @relation(fields: [patientId], references: [id])
  provider     User                   @relation(fields: [providerId], references: [id])
  imagingStudies NephrologyImaging[]
  biopsies     NephrologyBiopsy[]

  @@index([patientId])
  @@index([providerId])
  @@index([visitDate])
  @@index([status])
  @@index([ckdStage])
  @@map("nephrology_visits")
}

model NeurologyVisit {
  id           String               @id @default(cuid())
  patientId    String
  providerId   String
  status       NeurologyVisitStatus @default(SCHEDULED)
  visitDate    DateTime
  reason       String?              @db.Text
  symptoms     String?              @db.Text
  mentalStatus String?              @db.Text
  cranialNerves String?             @db.Text
  motorExam    String?              @db.Text
  sensoryExam  String?              @db.Text
  reflexes     String?              @db.Text
  coordination String?              @db.Text
  gait         String?              @db.Text
  speech       String?              @db.Text
  nihssScore   Int?
  gcsScore     Int?
  diagnosis    String?              @db.Text
  assessment   String?              @db.Text
  plan         String?              @db.Text
  notes        String?              @db.Text
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt

  patient      Patient              @relation(fields: [patientId], references: [id])
  provider     User                 @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([visitDate])
  @@index([status])
  @@map("neurology_visits")
}

model NephrologyLabResult {
  id               String   @id @default(cuid())
  patientId        String
  collectedAt      DateTime
  creatinine       Float?
  bun              Float?
  egfr             Float?
  potassium        Float?
  sodium           Float?
  chloride         Float?
  bicarbonate      Float?
  calcium          Float?
  phosphorus       Float?
  albumin          Float?
  hemoglobin       Float?
  pth              Float?
  vitaminD         Float?
  uricAcid         Float?
  urineProtein     Float?
  urineAlbumin     Float?
  urineCreatinine  Float?
  uacr             Float?
  upcr             Float?
  notes            String?  @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  patient          Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([collectedAt])
  @@map("nephrology_lab_results")
}

model NephrologyImaging {
  id           String                   @id @default(cuid())
  patientId    String
  providerId   String?
  visitId      String?
  status       NephrologyTestStatus     @default(ORDERED)
  performedAt  DateTime
  modality     NephrologyImagingModality
  studyType    String?
  findings     String?                  @db.Text
  impression   String?                  @db.Text
  notes        String?                  @db.Text
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt

  patient      Patient                  @relation(fields: [patientId], references: [id])
  provider     User?                    @relation(fields: [providerId], references: [id])
  visit        NephrologyVisit?         @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("nephrology_imaging_studies")
}

model NephrologyBiopsy {
  id               String                     @id @default(cuid())
  patientId        String
  providerId       String?
  visitId          String?
  status           NephrologyProcedureStatus  @default(SCHEDULED)
  performedAt      DateTime
  indication       String?                    @db.Text
  specimenType     String?
  pathologySummary String?                    @db.Text
  complications    String?                    @db.Text
  notes            String?                    @db.Text
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt

  patient          Patient                    @relation(fields: [patientId], references: [id])
  provider         User?                      @relation(fields: [providerId], references: [id])
  visit            NephrologyVisit?           @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("nephrology_biopsies")
}

model NephrologyMedicationOrder {
  id                 String                    @id @default(cuid())
  patientId          String
  providerId         String?
  medicationName     String
  dose               String?
  route              NephrologyMedicationRoute?
  frequency          String?
  startDate          DateTime?
  endDate            DateTime?
  lastAdministeredAt DateTime?
  isActive           Boolean                   @default(true)
  indication         String?                   @db.Text
  notes              String?                   @db.Text
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt

  patient            Patient                   @relation(fields: [patientId], references: [id])
  provider           User?                     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([isActive])
  @@map("nephrology_medication_orders")
}

model Encounter {
  id            String     @id @default(cuid())
  patientId     String
  providerId    String
  appointmentId String?    @unique
  createdById   String
  admissionId   String?
  status        EncounterStatus @default(OPEN)
  reasonForVisit String?
  diagnosis     String?    @db.Text
  assessment    String?    @db.Text
  plan          String?    @db.Text
  startTime     DateTime   @default(now())
  endTime       DateTime?
  notes         String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  patient    Patient   @relation(fields: [patientId], references: [id])
  provider   User      @relation("EncounterProvider", fields: [providerId], references: [id])
  appointment Appointment? @relation(fields: [appointmentId], references: [id])
  createdBy  User      @relation("EncounterCreatedBy", fields: [createdById], references: [id])
  admission Admission? @relation(fields: [admissionId], references: [id])
  orders    ClinicalOrder[]
  medicationOrders MedicationOrder[]
  invoices  Invoice[]

  @@index([patientId])
  @@index([providerId])
  @@index([admissionId])
  @@map("encounters")
}

model ClinicalOrder {
  id          String       @id @default(cuid())
  patientId   String
  providerId  String
  encounterId String?
  orderType   OrderType
  status      OrderStatus  @default(ORDERED)
  priority    OrderPriority @default(ROUTINE)
  orderedAt   DateTime     @default(now())
  orderName   String
  description String?      @db.Text
  notes       String?      @db.Text
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  patient     Patient      @relation(fields: [patientId], references: [id])
  provider    User         @relation(fields: [providerId], references: [id])
  encounter   Encounter?   @relation(fields: [encounterId], references: [id], onDelete: SetNull)
  results     ClinicalResult[]

  @@index([patientId])
  @@index([providerId])
  @@index([encounterId])
  @@index([orderType])
  @@index([status])
  @@map("clinical_orders")
}

model ClinicalResult {
  id             String       @id @default(cuid())
  orderId        String
  patientId      String
  reportedAt     DateTime     @default(now())
  resultName     String
  value          String?
  unit           String?
  referenceRange String?
  status         ResultStatus @default(PENDING)
  flag           ResultFlag   @default(NORMAL)
  notes          String?      @db.Text
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  order          ClinicalOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  patient        Patient       @relation(fields: [patientId], references: [id])

  @@index([orderId])
  @@index([patientId])
  @@index([reportedAt])
  @@index([status])
  @@index([flag])
  @@map("clinical_results")
}

model MedicationOrder {
  id                 String               @id @default(cuid())
  patientId          String
  providerId         String?
  encounterId        String?
  status             MedicationOrderStatus @default(ACTIVE)
  medicationName     String
  dose               String?
  route              MedicationRoute?
  frequency          String?
  startDate          DateTime?
  endDate            DateTime?
  lastAdministeredAt DateTime?
  indication         String?              @db.Text
  notes              String?              @db.Text
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt

  patient            Patient              @relation(fields: [patientId], references: [id])
  provider           User?                @relation(fields: [providerId], references: [id])
  encounter          Encounter?           @relation(fields: [encounterId], references: [id], onDelete: SetNull)
  administrations    MedicationAdministration[]

  @@index([patientId])
  @@index([providerId])
  @@index([encounterId])
  @@index([status])
  @@map("medication_orders")
}

model MedicationAdministration {
  id                 String                        @id @default(cuid())
  medicationOrderId  String
  patientId          String
  administeredById   String?
  administeredAt     DateTime                      @default(now())
  doseGiven          String?
  status             MedicationAdministrationStatus @default(GIVEN)
  notes              String?                       @db.Text
  createdAt          DateTime                      @default(now())
  updatedAt          DateTime                      @updatedAt

  medicationOrder    MedicationOrder               @relation(fields: [medicationOrderId], references: [id], onDelete: Cascade)
  patient            Patient                        @relation(fields: [patientId], references: [id])
  administeredBy     User?                          @relation(fields: [administeredById], references: [id])

  @@index([medicationOrderId])
  @@index([patientId])
  @@index([administeredById])
  @@index([administeredAt])
  @@index([status])
  @@map("medication_administrations")
}

model Ward {
  id           String   @id @default(cuid())
  name         String   @unique
  departmentId String?
  notes        String?  @db.Text
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  department   Department? @relation(fields: [departmentId], references: [id])
  beds         Bed[]
  admissions   Admission[]

  @@map("wards")
}

model Bed {
  id         String   @id @default(cuid())
  wardId     String
  roomNumber String?
  bedLabel   String
  status     BedStatus @default(AVAILABLE)
  isActive   Boolean  @default(true)
  notes      String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  ward       Ward     @relation(fields: [wardId], references: [id])
  admissions Admission[]

  @@index([wardId])
  @@index([status])
  @@map("beds")
}

model Admission {
  id           String          @id @default(cuid())
  patientId    String
  providerId   String
  wardId       String?
  bedId        String?
  departmentId String?
  status       AdmissionStatus @default(ADMITTED)
  admitDate    DateTime        @default(now())
  dischargeDate DateTime?
  reason       String?         @db.Text
  diagnosis    String?         @db.Text
  notes        String?         @db.Text
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  patient      Patient         @relation(fields: [patientId], references: [id])
  provider     User            @relation(fields: [providerId], references: [id])
  ward         Ward?           @relation(fields: [wardId], references: [id])
  bed          Bed?            @relation(fields: [bedId], references: [id])
  department   Department?     @relation(fields: [departmentId], references: [id])
  encounters   Encounter[]
  surgeries    Surgery[]

  @@index([patientId])
  @@index([providerId])
  @@index([status])
  @@index([admitDate])
  @@map("admissions")
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique
  patientId     String
  encounterId   String?
  status        InvoiceStatus @default(DRAFT)
  totalAmount   Float         @default(0)
  dueDate       DateTime?
  notes         String?       @db.Text
  createdById   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  patient       Patient       @relation(fields: [patientId], references: [id])
  encounter     Encounter?    @relation(fields: [encounterId], references: [id], onDelete: SetNull)
  createdBy     User?         @relation(fields: [createdById], references: [id])
  items         InvoiceItem[]
  payments      Payment[]
  claims        Claim[]

  @@index([patientId])
  @@index([encounterId])
  @@index([status])
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  description String
  quantity    Int      @default(1)
  unitPrice   Float
  totalPrice  Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Payment {
  id           String       @id @default(cuid())
  invoiceId    String
  patientId    String
  amount       Float
  method       PaymentMethod
  paidAt       DateTime     @default(now())
  reference    String?
  receivedById String?
  notes        String?      @db.Text
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  invoice      Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  patient      Patient      @relation(fields: [patientId], references: [id])
  receivedBy   User?        @relation(fields: [receivedById], references: [id])

  @@index([invoiceId])
  @@index([patientId])
  @@index([paidAt])
  @@index([method])
  @@map("payments")
}

model Claim {
  id          String      @id @default(cuid())
  invoiceId   String
  patientId   String
  payerName   String
  status      ClaimStatus @default(DRAFT)
  submittedAt DateTime?
  resolvedAt  DateTime?
  notes       String?     @db.Text
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  invoice     Invoice     @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  patient     Patient     @relation(fields: [patientId], references: [id])

  @@index([invoiceId])
  @@index([patientId])
  @@index([status])
  @@map("claims")
}

model OperatingTheater {
  id          String    @id @default(cuid())
  name        String    @unique
  location    String?
  status      String    @default("ACTIVE")
  notes       String?   @db.Text
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  surgeries   Surgery[]

  @@map("operating_theaters")
}

model Surgery {
  id              String          @id @default(cuid())
  patientId       String
  admissionId     String?
  theaterId       String?
  status          SurgeryStatus   @default(REQUESTED)
  priority        SurgeryPriority @default(ELECTIVE)
  scheduledStart  DateTime
  scheduledEnd    DateTime
  actualStart     DateTime?
  actualEnd       DateTime?
  preOpDiagnosis  String          @db.Text
  postOpDiagnosis String?         @db.Text
  procedureName   String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  patient         Patient           @relation(fields: [patientId], references: [id])
  admission       Admission?        @relation(fields: [admissionId], references: [id])
  theater         OperatingTheater? @relation(fields: [theaterId], references: [id])

  teamMembers     SurgeryTeamMember[]
  checklists      SurgeryChecklist[]
  anesthesiaRecord AnesthesiaRecord?
  operativeReport OperativeReport?

  @@index([patientId])
  @@index([status])
  @@index([scheduledStart])
  @@map("surgeries")
}

model SurgeryTeamMember {
  id        String       @id @default(cuid())
  surgeryId String
  userId    String
  role      SurgicalRole
  notes     String?      @db.Text
  surgery   Surgery      @relation(fields: [surgeryId], references: [id], onDelete: Cascade)
  user      User         @relation(fields: [userId], references: [id])
  @@unique([surgeryId, userId, role])
  @@map("surgery_team_members")
}

model SurgeryChecklist {
  id            String    @id @default(cuid())
  surgeryId     String
  stage         String
  items         Json
  completedById String
  completedAt   DateTime  @default(now())
  surgery       Surgery   @relation(fields: [surgeryId], references: [id], onDelete: Cascade)
  completedBy   User      @relation(fields: [completedById], references: [id])
  @@index([surgeryId])
  @@map("surgery_checklists")
}

model AnesthesiaRecord {
  id              String            @id @default(cuid())
  surgeryId       String            @unique
  anesthesiaType  AnesthesiaType
  asaStatus       AsaPhysicalStatus
  inductionTime   DateTime?
  emergenceTime   DateTime?
  airwayNotes     String?           @db.Text
  medications     Json?
  ivFluids        Json?
  bloodProducts   Json?
  complications   String?           @db.Text
  notes           String?           @db.Text
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  surgery         Surgery           @relation(fields: [surgeryId], references: [id], onDelete: Cascade)

  @@map("anesthesia_records")
}

// LIS - Laboratory Information System Models

enum LabTestCategory {
  HEMATOLOGY
  CHEMISTRY
  MICROBIOLOGY
  SEROLOGY
  IMMUNOLOGY
  MOLECULAR
  ENDOCRINOLOGY
  TOXICOLOGY
  URINALYSIS
  COAGULATION
  HISTOLOGY
  CYTOLOGY
  OTHER
}

enum SpecimenType {
  BLOOD
  SERUM
  PLASMA
  URINE
  STOOL
  CSF
  SPUTUM
  SWAB
  TISSUE
  FLUID
  BONE_MARROW
  OTHER
}

enum SpecimenStatus {
  ORDERED
  COLLECTED
  RECEIVED
  PROCESSING
  COMPLETED
  REJECTED
}

enum LabWorkOrderStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REJECTED
}

enum LabResultStatus {
  PENDING
  PRELIMINARY
  FINAL
  AMENDED
  CANCELLED
}

enum LabResultFlag {
  NORMAL
  LOW
  HIGH
  CRITICAL_LOW
  CRITICAL_HIGH
  BORDERLINE
}

model LabTest {
  id              String          @id @default(cuid())
  code            String          @unique
  name            String
  category        LabTestCategory
  description     String?         @db.Text
  specimenType    SpecimenType
  containerType   String?
  volumeRequired  Float?
  turnaroundTime  Int             @default(60) // minutes
  isActive        Boolean         @default(true)
  requiresFasting Boolean         @default(false)
  specialInstructions String?     @db.Text
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  referenceRanges ReferenceRange[]
  panelItems      LabTestPanelItem[]
  qcControls      QCControl[]
  workOrderItems  LabWorkOrderItem[]
  labResults      LabResult[]

  @@index([category])
  @@index([specimenType])
  @@index([isActive])
  @@map("lab_tests")
}

model TestPanel {
  id          String   @id @default(cuid())
  code        String   @unique
  name        String
  description String?  @db.Text
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  items       LabTestPanelItem[]

  @@index([isActive])
  @@map("test_panels")
}

model LabTestPanelItem {
  id        String    @id @default(cuid())
  panelId   String
  testId    String
  order     Int       @default(0)
  createdAt DateTime  @default(now())

  panel     TestPanel @relation(fields: [panelId], references: [id], onDelete: Cascade)
  test      LabTest   @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@unique([panelId, testId])
  @@index([panelId])
  @@index([testId])
  @@map("lab_test_panel_items")
}

model Specimen {
  id              String         @id @default(cuid())
  barcode         String         @unique
  patientId       String
  specimenType    SpecimenType
  collectionTime  DateTime       @default(now())
  collectedById   String?
  collectionSite  String?
  volumeCollected Float?
  collectionNotes String?        @db.Text
  receivedTime    DateTime?
  receivedById    String?
  receptionNotes  String?        @db.Text
  status          SpecimenStatus @default(ORDERED)
  rejectionReason String?        @db.Text
  storageLocation String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  // Relations
  patient         Patient        @relation(fields: [patientId], references: [id])
  collectedBy     User?          @relation(name: "SpecimenCollectedBy", fields: [collectedById], references: [id])
  receivedBy      User?          @relation(name: "SpecimenReceivedBy", fields: [receivedById], references: [id])
  workOrders      LabWorkOrder[]

  @@index([patientId])
  @@index([barcode])
  @@index([status])
  @@index([collectionTime])
  @@map("specimens")
}

model LabWorkOrder {
  id              String             @id @default(cuid())
  orderNumber     String             @unique
  patientId       String
  specimenId      String?
  clinicalOrderId String?
  testPanelId     String?
  orderedById     String
  orderedAt       DateTime           @default(now())
  priority        OrderPriority      @default(ROUTINE)
  status          LabWorkOrderStatus @default(PENDING)
  notes           String?            @db.Text
  startTime       DateTime?
  completedTime   DateTime?
  verifiedById    String?
  verifiedAt      DateTime?
  cancelledById   String?
  cancelledAt     DateTime?
  cancellationReason String?         @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  // Relations
  patient         Patient            @relation(fields: [patientId], references: [id])
  specimen        Specimen?          @relation(fields: [specimenId], references: [id])
  orderedBy       User               @relation(name: "LabWorkOrderOrderedBy", fields: [orderedById], references: [id])
  verifiedBy      User?              @relation(name: "LabWorkOrderVerifiedBy", fields: [verifiedById], references: [id])
  cancelledBy     User?              @relation(name: "LabWorkOrderCancelledBy", fields: [cancelledById], references: [id])
  items           LabWorkOrderItem[]
  results         LabResult[]

  @@index([patientId])
  @@index([specimenId])
  @@index([status])
  @@index([orderedAt])
  @@index([priority])
  @@map("lab_work_orders")
}

model LabWorkOrderItem {
  id              String   @id @default(cuid())
  workOrderId     String
  testId          String
  order           Int      @default(0)
  notes           String?  @db.Text
  createdAt       DateTime @default(now())

  workOrder       LabWorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Cascade)
  test            LabTest      @relation(fields: [testId], references: [id])

  @@unique([workOrderId, testId])
  @@index([workOrderId])
  @@index([testId])
  @@map("lab_work_order_items")
}

model LabResult {
  id              String          @id @default(cuid())
  workOrderId     String
  testId          String
  patientId       String
  value           String?
  numericValue    Float?
  unit            String?
  status          LabResultStatus @default(PENDING)
  flag            LabResultFlag   @default(NORMAL)
  referenceRange  String?         @db.Text
  interpretation  String?         @db.Text
  technicianId    String?
  resultedAt      DateTime?
  reviewerId      String?
  reviewedAt      DateTime?
  instrumentId    String?
  method          String?
  dilution        Float?
  comments        String?         @db.Text
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  workOrder       LabWorkOrder    @relation(fields: [workOrderId], references: [id], onDelete: Cascade)
  test            LabTest         @relation(fields: [testId], references: [id])
  patient         Patient         @relation(fields: [patientId], references: [id])
  technician      User?           @relation(name: "LabResultTechnician", fields: [technicianId], references: [id])
  reviewer        User?           @relation(name: "LabResultReviewer", fields: [reviewerId], references: [id])

  @@index([workOrderId])
  @@index([testId])
  @@index([patientId])
  @@index([status])
  @@index([flag])
  @@index([resultedAt])
  @@map("lab_results")
}

model ReferenceRange {
  id              String   @id @default(cuid())
  testId          String
  gender          Gender?
  ageMin          Int?     // months
  ageMax          Int?     // months
  lowValue        Float?
  highValue       Float?
  criticalLow     Float?
  criticalHigh    Float?
  isDefault       Boolean  @default(false)
  referenceText   String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  test            LabTest  @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@index([testId])
  @@index([gender])
  @@map("reference_ranges")
}

enum QCControlLevel {
  NORMAL
  ABNORMAL_LOW
  ABNORMAL_HIGH
}

enum QCResultStatus {
  PASS
  FAIL
  PENDING
}

model QCControl {
  id              String         @id @default(cuid())
  testId          String
  lotNumber       String
  level           QCControlLevel @default(NORMAL)
  targetValue     Float
  acceptableRange Float          // +/- acceptable range
  manufacturer    String?
  expiryDate      DateTime
  isActive        Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  test            LabTest        @relation(fields: [testId], references: [id])
  results         QCResult[]

  @@index([testId])
  @@index([isActive])
  @@index([expiryDate])
  @@map("qc_controls")
}

model QCResult {
  id              String         @id @default(cuid())
  controlId       String
  instrumentId    String?
  resultValue     Float
  status          QCResultStatus @default(PENDING)
  deviation       Float?         // calculated deviation from target
  runDate         DateTime       @default(now())
  technicianId    String?
  reviewedById    String?
  reviewedAt      DateTime?
  notes           String?        @db.Text
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  control         QCControl      @relation(fields: [controlId], references: [id], onDelete: Cascade)
  technician      User?          @relation(name: "QCResultTechnician", fields: [technicianId], references: [id])
  reviewedBy      User?          @relation(name: "QCResultReviewer", fields: [reviewedById], references: [id])

  @@index([controlId])
  @@index([runDate])
  @@index([status])
  @@map("qc_results")
}

model OperativeReport {
  id                   String      @id @default(cuid())
  surgeryId            String      @unique
  surgeonId            String
  procedureDescription String      @db.Text
  findings             String?     @db.Text
  woundClass           WoundClass?
  estimatedBloodLoss   Int?
  specimensRemoved     String?     @db.Text
  implantsInserted     String?     @db.Text
  complications        String?     @db.Text
  postOpInstructions   String?     @db.Text
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  surgery              Surgery     @relation(fields: [surgeryId], references: [id], onDelete: Cascade)
  surgeon              User        @relation(fields: [surgeonId], references: [id])
  @@map("operative_reports")
}
// ============================================
// CLINICAL SPECIALTIES EXPANSION
// ============================================

// ============================================
// NEUROLOGY EXTENSION
// ============================================

enum NeurologyTestStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NeurologyImagingType {
  CT_HEAD
  CT_HEAD_WITH_CONTRAST
  MRI_BRAIN
  MRI_BRAIN_WITH_CONTRAST
  CTA_HEAD
  MRA_HEAD
  PET_BRAIN
  OTHER
}

enum StrokeType {
  ISCHEMIC
  HEMORRHAGIC
  TIA
}

enum StrokeSeverity {
  MILD
  MODERATE
  SEVERE
}

enum SeizureType {
  FOCAL_ONSET_AWARE
  FOCAL_ONSET_IMPAIRED
  GENERALIZED_TONIC_CLONIC
  ABSENCE
  MYOCLONIC
  ATONIC
  UNKNOWN
  STATUS_EPILEPTICUS
}

model NeurologyEeg {
  id              String             @id @default(cuid())
  patientId       String
  providerId      String?
  visitId         String?
  status          NeurologyTestStatus @default(ORDERED)
  recordedAt      DateTime
  durationMinutes Int?
  indication      String?            @db.Text
  findings        String?            @db.Text
  interpretation  String?            @db.Text
  seizuresDetected Boolean           @default(false)
  seizureCount    Int?
  backgroundActivity String?
  sleepArchitecture String?
  photicStimulation Boolean?
  hyperventilation Boolean?
  notes           String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  patient         Patient            @relation(fields: [patientId], references: [id])
  provider        User?              @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([recordedAt])
  @@index([status])
  @@map("neurology_eegs")
}

model NeurologyEmg {
  id              String             @id @default(cuid())
  patientId       String
  providerId      String?
  visitId         String?
  status          NeurologyTestStatus @default(ORDERED)
  performedAt     DateTime
  indication      String?            @db.Text
  musclesTested   String?            @db.Text
  findings        String?            @db.Text
  interpretation  String?            @db.Text
  neuropathyPresent Boolean?
  myopathyPresent Boolean?
  conductionVelocity Float?
  amplitude       Float?
  distalLatency   Float?
  fWaveLatency    Float?
  notes           String?            @db.Text
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  patient         Patient            @relation(fields: [patientId], references: [id])
  provider        User?              @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([performedAt])
  @@index([status])
  @@map("neurology_emgs")
}

model NeurologyImaging {
  id              String                @id @default(cuid())
  patientId       String
  providerId      String?
  visitId         String?
  status          NeurologyTestStatus   @default(ORDERED)
  performedAt     DateTime
  imagingType     NeurologyImagingType
  indication      String?               @db.Text
  findings        String?               @db.Text
  impression      String?               @db.Text
  acuteFindings   Boolean               @default(false)
  strokePresent   Boolean               @default(false)
  hemorrhagePresent Boolean             @default(false)
  massPresent     Boolean               @default(false)
  contrastUsed    Boolean               @default(false)
  notes           String?               @db.Text
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  patient         Patient               @relation(fields: [patientId], references: [id])
  provider        User?                 @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([performedAt])
  @@index([status])
  @@index([imagingType])
  @@map("neurology_imaging")
}

model NeurologyStroke {
  id                  String          @id @default(cuid())
  patientId           String
  providerId          String
  onsetTime           DateTime
  arrivalTime         DateTime
  strokeType          StrokeType
  severity            StrokeSeverity
  nihssScore          Int
  nihssDetails        String?         @db.Text
  location            String?
  ctDone              Boolean         @default(false)
  ctTime              DateTime?
  ctFindings          String?         @db.Text
  mriDone             Boolean         @default(false)
  mriTime             DateTime?
  mriFindings         String?         @db.Text
  thrombolysisGiven   Boolean         @default(false)
  thrombolysisTime    DateTime?
  thrombectomyDone    Boolean         @default(false)
  thrombectomyTime    DateTime?
  tpaDose             Float?
  bpManagement        String?         @db.Text
  complications       String?         @db.Text
  dischargeNihss      Int?
  mrsAtDischarge      Int?
  dischargeDisposition String?
  notes               String?         @db.Text
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  patient             Patient         @relation(fields: [patientId], references: [id])
  provider            User            @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([onsetTime])
  @@index([strokeType])
  @@map("neurology_strokes")
}

model NeurologySeizure {
  id                  String       @id @default(cuid())
  patientId           String
  providerId          String?
  eventTime           DateTime
  seizureType         SeizureType
  durationSeconds     Int?
  witnessed           Boolean      @default(false)
  witnessedBy         String?
  auraPresent         Boolean      @default(false)
  auraDescription     String?
  lossOfConsciousness Boolean      @default(false)
  incontinence        Boolean      @default(false)
  tongueBite          Boolean      @default(false)
  postIctalConfusion  Boolean      @default(false)
  postIctalDuration   Int?
  triggers            String?
  eegCorrelation      String?
  medicationChange    String?
  injurySustained     String?
  notes               String?      @db.Text
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  patient             Patient      @relation(fields: [patientId], references: [id])
  provider            User?        @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([eventTime])
  @@index([seizureType])
  @@map("neurology_seizures")
}

model NeurologyCognitiveAssessment {
  id                  String   @id @default(cuid())
  patientId           String
  providerId          String
  assessmentDate      DateTime
  mmseScore           Int?
  mocaScore           Int?
  clockDrawingTest    String?
  verbalFluencyScore  Int?
  trailMakingA        Int?
  trailMakingB        Int?
  delayedRecall       Int?
  attentionTest       String?
  languageAssessment  String?
  visuospatialScore   Int?
  executiveFunction   String?
  overallImpression   String?  @db.Text
  diagnosis           String?
  recommendations     String?  @db.Text
  followUpNeeded      Boolean  @default(false)
  followUpDate        DateTime?
  notes               String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  patient             Patient  @relation(fields: [patientId], references: [id])
  provider            User     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([assessmentDate])
  @@map("neurology_cognitive_assessments")
}

// ============================================
// ONCOLOGY
// ============================================

enum ChemotherapyStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  DELAYED
  CANCELLED
  HELD
}

enum RadiationStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  DELAYED
  CANCELLED
  HELD
}

enum TumorBoardStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum CancerStage {
  STAGE_0
  STAGE_I
  STAGE_IA
  STAGE_IB
  STAGE_II
  STAGE_IIA
  STAGE_IIB
  STAGE_III
  STAGE_IIIA
  STAGE_IIIB
  STAGE_IIIC
  STAGE_IV
  UNKNOWN
}

model OncologyChemotherapy {
  id                  String             @id @default(cuid())
  patientId           String
  providerId          String
  protocolName        String
  cancerType          String
  cycleNumber         Int
  totalCycles         Int
  status              ChemotherapyStatus @default(PLANNED)
  scheduledDate       DateTime
  administeredDate    DateTime?
  premedications      String?            @db.Text
  chemotherapyAgents  String?            @db.Text
  doses               String?            @db.Text
  route               String?
  durationHours       Float?
  tolerance           String?            @db.Text
  sideEffects         String?            @db.Text
  doseModifications   String?            @db.Text
  nextCycleDate       DateTime?
  growthFactorGiven   Boolean            @default(false)
  labsReviewed        Boolean            @default(false)
  notes               String?            @db.Text
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  patient             Patient            @relation(fields: [patientId], references: [id])
  provider            User               @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([scheduledDate])
  @@index([status])
  @@map("oncology_chemotherapy")
}

model OncologyRadiation {
  id                  String          @id @default(cuid())
  patientId           String
  providerId          String
  cancerType          String
  treatmentSite       String
  totalDoseGy         Float
  fractions           Int
  dosePerFraction     Float
  status              RadiationStatus @default(PLANNED)
  startDate           DateTime?
  completionDate      DateTime?
  fractionNumber      Int             @default(0)
  technique           String?
  energy              String?
  simulationDate      DateTime?
  planningCtDate      DateTime?
  skinReactions       String?
  fatigueLevel        String?
  esophagitisGrade    String?
  otherSideEffects    String?         @db.Text
  treatmentBreaks     Int?
  breakReason         String?
  notes               String?         @db.Text
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  patient             Patient         @relation(fields: [patientId], references: [id])
  provider            User            @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([startDate])
  @@index([status])
  @@map("oncology_radiation")
}

model OncologyStaging {
  id                  String      @id @default(cuid())
  patientId           String
  providerId          String
  cancerType          String
  histology           String?
  grade               String?
  tStage              String?
  nStage              String?
  mStage              String?
  overallStage        CancerStage
  stageGrouping       String?
  stagingDate         DateTime
  stagingMethod       String?
  tumorSizeCm         Float?
  nodesPositive       Int?
  nodesExamined       Int?
  metastasisSites     String?
  biomarkers          String?     @db.Text
  stagingImaging      String?     @db.Text
  pathologyReport     String?     @db.Text
  notes               String?     @db.Text
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  patient             Patient     @relation(fields: [patientId], references: [id])
  provider            User        @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([stagingDate])
  @@index([cancerType])
  @@map("oncology_staging")
}

model OncologyTumorBoard {
  id                  String           @id @default(cuid())
  patientId           String
  presenterId         String
  status              TumorBoardStatus @default(SCHEDULED)
  meetingDate         DateTime
  cancerType          String
  stage               String?
  casePresentation    String?          @db.Text
  imagingReviewed     String?          @db.Text
  pathologyReviewed   String?          @db.Text
  molecularTesting    String?
  treatmentOptions    String?          @db.Text
  recommendedPlan     String?          @db.Text
  clinicalTrialOffered Boolean         @default(false)
  trialName           String?
  attendees           String?          @db.Text
  consensusReached    Boolean          @default(false)
  notes               String?          @db.Text
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  patient             Patient          @relation(fields: [patientId], references: [id])
  presenter           User             @relation(fields: [presenterId], references: [id])

  @@index([patientId])
  @@index([presenterId])
  @@index([meetingDate])
  @@index([status])
  @@map("oncology_tumor_boards")
}

// ============================================
// ORTHOPEDICS
// ============================================

enum FractureType {
  CLOSED
  OPEN_GUSTILO_I
  OPEN_GUSTILO_II
  OPEN_GUSTILO_IIIA
  OPEN_GUSTILO_IIIB
  OPEN_GUSTILO_IIIC
}

enum FractureStatus {
  ACUTE
  HEALING
  HEALED
  DELAYED_UNION
  NON_UNION
  MALUNION
}

enum JointType {
  HIP
  KNEE
  SHOULDER
  ELBOW
  ANKLE
  WRIST
  OTHER
}

model OrthopedicFracture {
  id                  String         @id @default(cuid())
  patientId           String
  providerId          String
  injuryDate          DateTime
  fractureType        FractureType
  bone                String
  location            String
  classification      String?
  displacement        String?
  angulation          Float?
  comminution         Boolean        @default(false)
  status              FractureStatus @default(ACUTE)
  reductionPerformed  Boolean        @default(false)
  reductionDate       DateTime?
  fixationType        String?
  implantUsed         String?
  surgeryDate         DateTime?
  complications       String?        @db.Text
  healingProgress     String?        @db.Text
  followUpXrayDate    DateTime?
  weightBearingStatus String?
  physicalTherapyStarted DateTime?
  notes               String?        @db.Text
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt

  patient             Patient        @relation(fields: [patientId], references: [id])
  provider            User           @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([injuryDate])
  @@index([status])
  @@map("orthopedic_fractures")
}

model OrthopedicJointReplacement {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  surgeryDate         DateTime
  jointType           JointType
  side                String
  approach            String?
  implantManufacturer String?
  implantModel        String?
  implantSize         String?
  bearingSurface      String?
  fixation            String?
  anesthesiaType      String?
  tourniquetTime      Int?
  estimatedBloodLoss  Int?
  complications       String?   @db.Text
  preOpHarrisHipScore Int?
  postOpHarrisHipScore Int?
  preOpKssScore       Int?
  postOpKssScore      Int?
  rangeOfMotion       String?
  infection           Boolean   @default(false)
  dislocation         Boolean   @default(false)
  revisionNeeded      Boolean   @default(false)
  revisionDate        DateTime?
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([surgeryDate])
  @@index([jointType])
  @@map("orthopedic_joint_replacements")
}

model OrthopedicPhysicalTherapy {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  referralDate        DateTime
  diagnosis           String
  treatmentGoals      String?   @db.Text
  sessionsPlanned     Int
  sessionsCompleted   Int       @default(0)
  currentStatus       String    @default("ACTIVE")
  modalities          String?
  therapeuticExercises String?  @db.Text
  gaitTraining        Boolean   @default(false)
  balanceTraining     Boolean   @default(false)
  strengthening       String?
  rangeOfMotion       String?
  functionalActivities String?  @db.Text
  painLevel           Int?
  progressNotes       String?   @db.Text
  nextSessionDate     DateTime?
  dischargeDate       DateTime?
  dischargeStatus     String?
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([referralDate])
  @@index([currentStatus])
  @@map("orthopedic_physical_therapy")
}

// ============================================
// PULMONOLOGY
// ============================================

enum SpirometryQuality {
  GOOD
  FAIR
  POOR
  REJECTED
}

enum SleepApneaSeverity {
  NONE
  MILD
  MODERATE
  SEVERE
}

model PulmonologySpirometry {
  id                  String           @id @default(cuid())
  patientId           String
  providerId          String?
  testDate            DateTime
  indication          String?
  qualityGrade        SpirometryQuality
  fev1                Float
  fvc                 Float
  fev1FvcRatio        Float
  predictedFev1       Float?
  predictedFvc        Float?
  percentPredictedFev1 Float?
  percentPredictedFvc Float?
  fef2575             Float?
  bronchodilatorGiven Boolean          @default(false)
  postBdFev1          Float?
  postBdFvc           Float?
  postBdRatio         Float?
  significantResponse Boolean          @default(false)
  interpretation      String?          @db.Text
  diagnosis           String?
  notes               String?          @db.Text
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  patient             Patient          @relation(fields: [patientId], references: [id])
  provider            User?            @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([testDate])
  @@map("pulmonology_spirometry")
}

model PulmonologySleepStudy {
  id                  String             @id @default(cuid())
  patientId           String
  providerId          String?
  studyDate           DateTime
  studyType           String
  ahi                 Float
  rdi                 Float?
  odi                 Float?
  meanSpo2            Float?
  nadirSpo2           Float?
  timeBelow90         Float?
  sleepEfficiency     Float?
  totalSleepTime      Int?
  remPercentage       Float?
  deepSleepPercentage Float?
  apneaSeverity       SleepApneaSeverity
  centralApneaIndex   Float?
  obstructiveApneaIndex Float?
  hypopneaIndex       Float?
  cpapRecommended     Boolean            @default(false)
  cpapPressure        Float?
  bipapRecommended    Boolean            @default(false)
  bipapSettings       String?
  positionalTherapy   Boolean            @default(false)
  oralAppliance       Boolean            @default(false)
  surgicalEvaluation  Boolean            @default(false)
  notes               String?            @db.Text
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt

  patient             Patient            @relation(fields: [patientId], references: [id])
  provider            User?              @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([studyDate])
  @@index([apneaSeverity])
  @@map("pulmonology_sleep_studies")
}

model PulmonologyBronchoscopy {
  id                  String   @id @default(cuid())
  patientId           String
  providerId          String
  procedureDate       DateTime
  indication          String   @db.Text
  anesthesia          String?
  vocalCords          String?
  trachea             String?
  carina              String?
  rightMainBronchus   String?
  leftMainBronchus    String?
  lobarBranches       String?  @db.Text
  segmentalBranches   String?  @db.Text
  abnormalitiesFound  Boolean  @default(false)
  abnormalities       String?  @db.Text
  biopsiesTaken       Int      @default(0)
  biopsySites         String?
  balfPerformed       Boolean  @default(false)
  balSites            String?
  balResults          String?  @db.Text
  brushingsTaken      Boolean  @default(false)
  complications       String?  @db.Text
  postOpInstructions  String?  @db.Text
  notes               String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  patient             Patient  @relation(fields: [patientId], references: [id])
  provider            User     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([procedureDate])
  @@map("pulmonology_bronchoscopies")
}

// ============================================
// GASTROENTEROLOGY
// ============================================

enum EndoscopyStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum EndoscopyQuality {
  EXCELLENT
  GOOD
  FAIR
  POOR
}

model GastroEndoscopy {
  id                  String           @id @default(cuid())
  patientId           String
  providerId          String
  procedureDate       DateTime
  indication          String           @db.Text
  status              EndoscopyStatus  @default(SCHEDULED)
  sedationType        String?
  scopeInsertion      String?
  esophagus           String?
  gastroesophagealJunction String?
  stomach             String?          @db.Text
  pylorus             String?
  duodenum            String?          @db.Text
  mucosalAppearance   String?
  lesionsFound        Boolean          @default(false)
  lesionsDescription  String?          @db.Text
  biopsiesTaken       Int              @default(0)
  biopsySites         String?
  hemostasisPerformed Boolean          @default(false)
  hemostasisMethod    String?
  polypectomy         Boolean          @default(false)
  polypsRemoved       Int              @default(0)
  polypSizeMm         Float?
  complications       String?          @db.Text
  recommendations     String?          @db.Text
  followUpInterval    String?
  prepQuality         EndoscopyQuality?
  notes               String?          @db.Text
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  patient             Patient          @relation(fields: [patientId], references: [id])
  provider            User             @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([procedureDate])
  @@index([status])
  @@map("gastro_endoscopies")
}

model GastroColonoscopy {
  id                  String           @id @default(cuid())
  patientId           String
  providerId          String
  procedureDate       DateTime
  indication          String           @db.Text
  status              EndoscopyStatus  @default(SCHEDULED)
  sedationType        String?
  scopeInsertion      String?
  cecalIntubation     Boolean          @default(false)
  cecalIntubationTime Int?
  withdrawalTime      Int?
  prepQuality         EndoscopyQuality?
  ileumExamined       Boolean          @default(false)
  mucosalAppearance   String?
  lesionsFound        Boolean          @default(false)
  lesionsDescription  String?          @db.Text
  polypsFound         Boolean          @default(false)
  polypsRemoved       Int              @default(0)
  polypSizeMaxMm      Float?
  polypHistology      String?
  biopsiesTaken       Int              @default(0)
  biopsySites         String?
  hemostasisPerformed Boolean          @default(false)
  complications       String?          @db.Text
  recommendations     String?          @db.Text
  followUpInterval    String?
  notes               String?          @db.Text
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  patient             Patient          @relation(fields: [patientId], references: [id])
  provider            User             @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([procedureDate])
  @@index([status])
  @@map("gastro_colonoscopies")
}

model GastroLiverFunction {
  id                  String   @id @default(cuid())
  patientId           String
  testDate            DateTime
  alt                 Float?
  ast                 Float?
  alp                 Float?
  ggt                 Float?
  totalBilirubin      Float?
  directBilirubin     Float?
  indirectBilirubin   Float?
  totalProtein        Float?
  albumin             Float?
  globulin            Float?
  agRatio             Float?
  pt                  Float?
  inr                 Float?
  ptt                 Float?
  fibroscanScore      Float?
  fibrosisStage       String?
  steatosisGrade      String?
  capScore            Float?
  diagnosis           String?
  interpretation      String?  @db.Text
  notes               String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  patient             Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([testDate])
  @@map("gastro_liver_function")
}

// ============================================
// ENDOCRINOLOGY
// ============================================

enum DiabetesType {
  TYPE_1
  TYPE_2
  GESTATIONAL
  LADA
  MODY
  SECONDARY
  PREDIABETES
}

enum InsulinType {
  RAPID_ACTING
  SHORT_ACTING
  INTERMEDIATE
  LONG_ACTING
  ULTRA_LONG
  PREMIXED
}

model EndoDiabetes {
  id                  String      @id @default(cuid())
  patientId           String
  providerId          String
  diagnosisDate       DateTime
  diabetesType        DiabetesType
  hba1cAtDiagnosis    Float?
  currentHbA1c        Float?
  hba1cDate           DateTime?
  fastingGlucose      Float?
  postprandialGlucose Float?
  targetFasting       Float       @default(80)
  targetPostprandial  Float       @default(140)
  targetHbA1c         Float       @default(7.0)
  complications       String?     @db.Text
  retinopathy         Boolean     @default(false)
  nephropathy         Boolean     @default(false)
  neuropathy          Boolean     @default(false)
  cardiovascular      Boolean     @default(false)
  footExamDate        DateTime?
  footExamFindings    String?
  eyeExamDate         DateTime?
  eyeExamFindings     String?
  lastNephrologyReferral DateTime?
  dietitianReferral   Boolean     @default(false)
  diabetesEducator    Boolean     @default(false)
  selfMonitoring      Boolean     @default(false)
  monitoringFrequency String?
  lifestyleModifications String?  @db.Text
  notes               String?     @db.Text
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  patient             Patient     @relation(fields: [patientId], references: [id])
  provider            User        @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([diagnosisDate])
  @@index([diabetesType])
  @@map("endo_diabetes")
}

model EndoInsulin {
  id                  String      @id @default(cuid())
  patientId           String
  providerId          String
  prescriptionDate    DateTime
  insulinType         InsulinType
  brandName           String?
  morningDose         Float?
  noonDose            Float?
  eveningDose         Float?
  bedtimeDose         Float?
  correctionFactor    Float?
  carbRatio           Float?
  basalRate           Float?
  siteRotation        String?
  storageInstructions String?
  hypoglycemiaAwareness Boolean   @default(true)
  glucagonAvailable   Boolean     @default(false)
  lastHbA1c           Float?
  adjustmentsMade     String?     @db.Text
  sideEffects         String?
  adherence           String?
  isActive            Boolean     @default(true)
  notes               String?     @db.Text
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  patient             Patient     @relation(fields: [patientId], references: [id])
  provider            User        @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([prescriptionDate])
  @@index([isActive])
  @@map("endo_insulin")
}

model EndoThyroid {
  id                  String   @id @default(cuid())
  patientId           String
  providerId          String
  testDate            DateTime
  tsh                 Float?
  freeT3              Float?
  freeT4              Float?
  totalT3             Float?
  totalT4             Float?
  tpoAntibodies       Float?
  tgAntibodies        Float?
  thyroglobulin       Float?
  calcitonin          Float?
  diagnosis           String?
  thyroidSize         String?
  nodulesPresent      Boolean  @default(false)
  noduleDescription   String?
  biopsyRecommended   Boolean  @default(false)
  biopsyResults       String?  @db.Text
  medication          String?
  dose                String?
  targetTsh           Float?
  symptoms            String?  @db.Text
  followUpNeeded      Boolean  @default(true)
  followUpDate        DateTime?
  notes               String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  patient             Patient  @relation(fields: [patientId], references: [id])
  provider            User     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([testDate])
  @@map("endo_thyroid")
}

// ============================================
// OBGYN
// ============================================

enum PregnancyStatus {
  ACTIVE
  COMPLETED
  MISCARRIAGE
  TERMINATED
  ECTOPIC
  MOLAR
}

enum Trimester {
  FIRST
  SECOND
  THIRD
}

enum DeliveryMode {
  VAGINAL_SPONTANEOUS
  VAGINAL_ASSISTED_VACUUM
  VAGINAL_ASSISTED_FORCEPS
  CESAREAN_ELECTIVE
  CESAREAN_EMERGENCY
}

model ObgynPregnancy {
  id                  String          @id @default(cuid())
  patientId           String
  providerId          String
  lmpDate             DateTime
  eddDate             DateTime
  gestationalAgeWeeks Int             @default(0)
  gravida             Int
  para                Int
  abortions           Int
  livingChildren      Int
  status              PregnancyStatus @default(ACTIVE)
  conceptionMethod    String?
  ivfCycleNumber      String?
  multipleGestation   Boolean         @default(false)
  numberOfFetuses     Int             @default(1)
  riskFactors         String?         @db.Text
  previousCesarean    Int             @default(0)
  rhStatus            String?
  rubellaStatus       String?
  hepatitisBStatus    String?
  hivStatus           String?
  syphilisStatus      String?
  gbsStatus           String?
  initialWeight       Float?
  initialBmi          Float?
  preExistingConditions String?       @db.Text
  currentMedications  String?         @db.Text
  allergies           String?         @db.Text
  deliveryDate        DateTime?
  deliveryMode        DeliveryMode?
  deliveryOutcome     String?
  babyWeightGrams     Int?
  babyApgar1          Int?
  babyApgar5          Int?
  babyApgar10         Int?
  complications       String?         @db.Text
  notes               String?         @db.Text
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  patient             Patient         @relation(fields: [patientId], references: [id])
  provider            User            @relation(fields: [providerId], references: [id])
  antenalVisits       ObgynAntenatal[]

  @@index([patientId])
  @@index([providerId])
  @@index([eddDate])
  @@index([status])
  @@map("obgyn_pregnancies")
}

model ObgynAntenatal {
  id                  String    @id @default(cuid())
  pregnancyId         String
  visitDate           DateTime
  gestationalAgeWeeks Int
  trimester           Trimester
  weight              Float?
  bloodPressure       String?
  fundalHeight        Float?
  fetalHeartRate      Int?
  fetalMovement       Boolean?
  presentation        String?
  edema               String?
  proteinuria         String?
  glucosuria          String?
  hemoglobin          Float?
  ultrasoundFindings  String?   @db.Text
  screeningTests      String?   @db.Text
  medications         String?
  complaints          String?   @db.Text
  nextVisitDate       DateTime?
  riskAssessment      String?
  referralNeeded      Boolean   @default(false)
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  pregnancy           ObgynPregnancy @relation(fields: [pregnancyId], references: [id], onDelete: Cascade)

  @@index([pregnancyId])
  @@index([visitDate])
  @@map("obgyn_antenatal")
}

model ObgynDelivery {
  id                  String       @id @default(cuid())
  patientId           String
  providerId          String
  deliveryDate        DateTime
  admissionTime       DateTime
  deliveryTime        DateTime
  deliveryMode        DeliveryMode
  gestationalAgeWeeks Int
  laborOnset          String?
  membranesRuptured   DateTime?
  fluidColor          String?
  inductionPerformed  Boolean      @default(false)
  inductionMethod     String?
  augmentation        Boolean      @default(false)
  anesthesia          String?
  secondStageDuration Int?
  episiotomy          Boolean      @default(false)
  laceration          String?
  estimatedBloodLoss  Int?
  placentaDelivery    String?
  placentaComplete    Boolean      @default(true)
  babyWeightGrams     Int
  babyLengthCm        Float?
  babyHeadCircumferenceCm Float?
  babyGender          String
  babyApgar1          Int
  babyApgar5          Int
  babyApgar10         Int?
  resuscitationNeeded Boolean      @default(false)
  resuscitationDetails String?
  nicuAdmission       Boolean      @default(false)
  nicuReason          String?
  maternalComplications String?    @db.Text
  postpartumHb        Float?
  rhogamGiven         Boolean      @default(false)
  dischargeDate       DateTime?
  breastfeedingEstablished Boolean @default(false)
  contraceptionCounseling Boolean @default(false)
  notes               String?      @db.Text
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  patient             Patient      @relation(fields: [patientId], references: [id])
  provider            User         @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([deliveryDate])
  @@map("obgyn_deliveries")
}

// ============================================
// PEDIATRICS
// ============================================

model PedsGrowthChart {
  id                  String   @id @default(cuid())
  patientId           String
  providerId          String
  measurementDate     DateTime
  ageMonths           Int
  weightKg            Float
  heightCm            Float
  headCircumferenceCm Float?
  bmi                 Float?
  weightPercentile    Float?
  heightPercentile    Float?
  bmiPercentile       Float?
  headCircPercentile  Float?
  weightForLength     Float?
  growthVelocity      String?
  nutritionalStatus   String?
  zScoreWeight        Float?
  zScoreHeight        Float?
  plotOnWhoChart      Boolean  @default(true)
  plotOnCdcChart      Boolean  @default(false)
  prematureCorrection Boolean  @default(false)
  weeksPremature      Int?
  notes               String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  patient             Patient  @relation(fields: [patientId], references: [id])
  provider            User     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([measurementDate])
  @@map("peds_growth_charts")
}

model PedsVaccination {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  vaccineName         String
  vaccineCode         String?
  doseNumber          Int
  totalDoses          Int
  dateGiven           DateTime
  ageAtVaccination    String?
  site                String?
  route               String?
  lotNumber           String?
  manufacturer        String?
  expirationDate      DateTime?
  sideEffects         String?
  contraindications   String?
  catchUpSchedule     Boolean   @default(false)
  dueDate             DateTime?
  nextDoseDue         DateTime?
  administeredBy      String?
  consentSigned       Boolean   @default(true)
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([vaccineName])
  @@index([dateGiven])
  @@map("peds_vaccinations")
}

model PedsDevelopmental {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  assessmentDate      DateTime
  ageMonths           Int
  grossMotor          String?   @db.Text
  fineMotor           String?   @db.Text
  language            String?   @db.Text
  socialEmotional     String?   @db.Text
  cognitive           String?   @db.Text
  problemSolving      String?   @db.Text
  personalSocial      String?   @db.Text
  concernsIdentified  Boolean   @default(false)
  concernsDescription String?   @db.Text
  milestonesAchieved  String?   @db.Text
  milestonesDelayed   String?   @db.Text
  asqCompleted        Boolean   @default(false)
  asqScore            String?
  mchatCompleted      Boolean   @default(false)
  mchatScore          Int?
  autismScreenPositive Boolean  @default(false)
  earlyInterventionReferral Boolean @default(false)
  speechTherapyReferral Boolean @default(false)
  occupationalTherapyReferral Boolean @default(false)
  hearingTestDone     Boolean   @default(false)
  visionTestDone      Boolean   @default(false)
  followUpNeeded      Boolean   @default(false)
  followUpDate        DateTime?
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([assessmentDate])
  @@map("peds_developmental")
}

// ============================================
// PSYCHIATRY
// ============================================

enum AssessmentType {
  INITIAL
  FOLLOW_UP
  CRISIS
  DISCHARGE
  ANNUAL
  PRE_ADMISSION
  FORENSIC
}

enum TherapyType {
  INDIVIDUAL
  GROUP
  FAMILY
  COUPLES
  COGNITIVE_BEHAVIORAL
  DIALECTICAL_BEHAVIORAL
  PSYCHODYNAMIC
  SUPPORTIVE
  EXPOSURE
}

model PsychiatryAssessment {
  id                  String         @id @default(cuid())
  patientId           String
  providerId          String
  assessmentDate      DateTime
  assessmentType      AssessmentType
  chiefComplaint      String         @db.Text
  historyOfPresentIllness String?    @db.Text
  pastPsychiatricHistory String?     @db.Text
  pastMedicalHistory  String?        @db.Text
  familyHistory       String?        @db.Text
  socialHistory       String?        @db.Text
  substanceUseHistory String?        @db.Text
  currentMedications  String?        @db.Text
  allergies           String?
  reviewOfSystems     String?        @db.Text
  mentalStatusExam    String?        @db.Text
  appearance          String?
  behavior            String?
  speech              String?
  mood                String?
  affect              String?
  thoughtProcess      String?
  thoughtContent      String?
  perceptions         String?
  cognition           String?
  insight             String?
  judgment            String?
  phq9Score           Int?
  gad7Score           Int?
  mdqScore            Int?
  pcptsdScore         Int?
  c_ssrsScore         Int?
  riskAssessment      String?        @db.Text
  suicidalIdeation    Boolean        @default(false)
  suicidalPlan        Boolean        @default(false)
  suicidalIntent      Boolean        @default(false)
  homicidalIdeation   Boolean        @default(false)
  selfHarmBehaviors   Boolean        @default(false)
  diagnosisPrimary    String?
  diagnosisSecondary  String?
  diagnosisCodes      String?
  formulation         String?        @db.Text
  plan                String?        @db.Text
  medicationsStarted  String?        @db.Text
  psychotherapyRecommended Boolean   @default(false)
  therapyType         String?
  followUpInterval    String?
  urgentFollowUp      Boolean        @default(false)
  notes               String?        @db.Text
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt

  patient             Patient        @relation(fields: [patientId], references: [id])
  provider            User           @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([assessmentDate])
  @@index([assessmentType])
  @@map("psychiatry_assessments")
}

model PsychiatryTherapy {
  id                  String     @id @default(cuid())
  patientId           String
  providerId          String
  sessionDate         DateTime
  therapyType         TherapyType
  sessionNumber       Int
  durationMinutes     Int        @default(50)
  subjective          String?    @db.Text
  objective           String?    @db.Text
  assessment          String?    @db.Text
  plan                String?    @db.Text
  interventionsUsed   String?    @db.Text
  homeworkAssigned    String?    @db.Text
  progressNotes       String?    @db.Text
  moodRating          Int?
  anxietyRating       Int?
  functioningLevel    String?
  goalsDiscussed      String?    @db.Text
  barriersIdentified  String?    @db.Text
  copingStrategies    String?    @db.Text
  crisisPlanReviewed  Boolean    @default(false)
  medicationAdherence String?
  sideEffectsDiscussed Boolean   @default(false)
  patientEngagement   String?
  nextSessionDate     DateTime?
  noShow              Boolean    @default(false)
  cancellationReason  String?
  urgentIssues        String?    @db.Text
  safetyPlanUpdated   Boolean    @default(false)
  notes               String?    @db.Text
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  patient             Patient    @relation(fields: [patientId], references: [id])
  provider            User       @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([sessionDate])
  @@index([therapyType])
  @@map("psychiatry_therapy")
}

model PsychiatryMedication {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  assessmentDate      DateTime
  medicationName      String
  genericName         String?
  dose                String
  frequency           String
  route               String?
  indication          String?
  startedDate         DateTime?
  prescribedBy        String?
  adherenceRating     Int?
  adherenceBarriers   String?   @db.Text
  effectivenessRating Int?
  sideEffectsPresent  Boolean   @default(false)
  sideEffects         String?   @db.Text
  sideEffectSeverity  String?
  weightChanges       Float?
  sedationLevel       String?
  akathisiaPresent    Boolean   @default(false)
  tremorPresent       Boolean   @default(false)
  bloodWorkNeeded     Boolean   @default(false)
  lastClozapineLevel  Float?
  lastLithiumLevel    Float?
  lastValproateLevel  Float?
  ecgNeeded           Boolean   @default(false)
  metabolicMonitoring Boolean   @default(false)
  changesMade         String?   @db.Text
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([assessmentDate])
  @@index([medicationName])
  @@map("psychiatry_medication")
}

// ============================================
// DERMATOLOGY
// ============================================

enum LesionType {
  MACULE
  PAPULE
  PLAQUE
  NODULE
  TUMOR
  VESICLE
  BULLA
  PUSTULE
  WHEAL
  CYST
  ULCER
  EROSION
  SCALE
  CRUST
  SCAR
  EXCORIATION
}

enum BiopsyType {
  SHAVE
  PUNCH
  EXCISIONAL
  INCISIONAL
  WEDGE
  MOHS
}

model DermLesion {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  dateNoted           DateTime
  location            String
  lesionType          LesionType
  sizeMm              Float
  color               String?
  shape               String?
  border              String?
  symmetry            String?
  elevation           String?
  surface             String?
  surroundingSkin     String?
  symptoms            String?
  duration            String?
  changes             String?
  previousTrauma      Boolean   @default(false)
  familyHistory       String?
  personalHistory     String?
  sunExposure         String?
  abcdScore           Int?
  sevenPointChecklist Int?
  dermoscopyUsed      Boolean   @default(false)
  dermoscopyFindings  String?   @db.Text
  photographyDone     Boolean   @default(false)
  suspiciousFeatures  String?   @db.Text
  biopsyRecommended   Boolean   @default(false)
  biopsyType          BiopsyType?
  diagnosisClinical   String?
  management          String?   @db.Text
  followUpWeeks       Int?
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([dateNoted])
  @@index([lesionType])
  @@map("derm_lesions")
}

model DermBiopsy {
  id                  String     @id @default(cuid())
  patientId           String
  providerId          String
  biopsyDate          DateTime
  lesionId            String?
  location            String
  biopsyType          BiopsyType
  localAnesthetic     String     @default("Lidocaine 1%")
  sutureType          String?
  sutureCount         Int?
  specimenLabel       String
  sentToPathology     Boolean    @default(true)
  pathologyLab        String?
  clinicalImpression  String?    @db.Text
  differentialDiagnosis String?  @db.Text
  woundCareInstructions String?  @db.Text
  sutureRemovalDate   DateTime?
  complications       String?    @db.Text
  pathologyReceived   Boolean    @default(false)
  pathologyReportDate DateTime?
  pathologicDiagnosis String?    @db.Text
  histology           String?    @db.Text
  margins             String?
  depthMm             Float?
  ulcerationPresent   Boolean    @default(false)
  mitoticRate         String?
  breslowDepth        Float?
  clarkLevel          Int?
  tnmStage            String?
  furtherTreatment    String?    @db.Text
  notes               String?    @db.Text
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt

  patient             Patient    @relation(fields: [patientId], references: [id])
  provider            User       @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([biopsyDate])
  @@index([biopsyType])
  @@map("derm_biopsies")
}

// ============================================
// OPHTHALMOLOGY
// ============================================

enum EyeSide {
  RIGHT
  LEFT
  BOTH
}

model OphthExam {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  examDate            DateTime
  chiefComplaint      String?   @db.Text
  history             String?   @db.Text
  lastExam            DateTime?
  visualAcuityRight   String?
  visualAcuityLeft    String?
  bestCorrectedRight  String?
  bestCorrectedLeft   String?
  pinholeRight        String?
  pinholeLeft         String?
  nearVisionRight     String?
  nearVisionLeft      String?
  iopRight            Float?
  iopLeft             Float?
  iopMethod           String?
  pupils              String?
  extraocularMotility String?
  confrontationFields String?
  externalExam        String?   @db.Text
  slitLampExam        String?   @db.Text
  anteriorSegment     String?   @db.Text
  lens                String?   @db.Text
  vitreous            String?   @db.Text
  fundusExam          String?   @db.Text
  opticNerve          String?   @db.Text
  macula              String?   @db.Text
  vessels             String?   @db.Text
  periphery           String?   @db.Text
  gonioscopy          String?   @db.Text
  refractionRight     String?
  refractionLeft      String?
  diagnosis           String?   @db.Text
  plan                String?   @db.Text
  glassesPrescribed   Boolean   @default(false)
  medicationPrescribed String?  @db.Text
  followUpWeeks       Int?
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([examDate])
  @@map("ophth_exams")
}

model OphthVisualAcuity {
  id                  String   @id @default(cuid())
  patientId           String
  providerId          String?
  testDate            DateTime
  eyeSide             EyeSide
  distanceUncorrected String?
  distanceCorrected   String?
  nearUncorrected     String?
  nearCorrected       String?
  pinhole             String?
  lensPower           String?
  snellenFraction     String?
  logmarScore         Float?
  etdrsLetters        Int?
  contrastSensitivity String?
  colorVision         String?
  amslerGrid          String?
  amslerAbnormal      Boolean  @default(false)
  redDesaturation     Boolean  @default(false)
  diagnosis           String?
  notes               String?  @db.Text
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  patient             Patient  @relation(fields: [patientId], references: [id])
  provider            User?    @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([testDate])
  @@index([eyeSide])
  @@map("ophth_visual_acuity")
}

model OphthFundus {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String?
  examDate            DateTime
  eyeSide             EyeSide
  dilationUsed        String?
  cupDiscRatio        Float?
  neuroretinalRim     String?
  discColor           String?
  discMargins         String?
  peripapillaryAtrophy String?
  vesselAppearance    String?
  avRatio             String?
  nipping             Boolean   @default(false)
  crossingChanges     Boolean   @default(false)
  maculaAppearance    String?   @db.Text
  fovealReflex        Boolean   @default(true)
  drusenPresent       Boolean   @default(false)
  drusenDescription   String?
  hemorrhages         Boolean   @default(false)
  hemorrhageDescription String?
  exudates            Boolean   @default(false)
  exudateType         String?
  cottonWoolSpots     Boolean   @default(false)
  microaneurysms      Boolean   @default(false)
  neovascularization  Boolean   @default(false)
  retinalDetachment   Boolean   @default(false)
  tearsOrHoles        Boolean   @default(false)
  latticeDegeneration Boolean   @default(false)
  peripheralPathology String?   @db.Text
  diabeticRetinopathy String?
  hypertensiveChanges String?
  amdSeverity         String?
  glaucomaSuspect     Boolean   @default(false)
  photosTaken         Boolean   @default(false)
  octRecommended      Boolean   @default(false)
  faRecommended       Boolean   @default(false)
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User?     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([examDate])
  @@index([eyeSide])
  @@map("ophth_fundus")
}

// ============================================
// ENT
// ============================================

enum HearingLossType {
  CONDUCTIVE
  SENSORINEURAL
  MIXED
  NORMAL
}

model EntAudiometry {
  id                  String          @id @default(cuid())
  patientId           String
  providerId          String?
  testDate            DateTime
  testType            String          @default("Pure Tone Audiometry")
  right250Hz          Int?
  right500Hz          Int?
  right1000Hz         Int?
  right2000Hz         Int?
  right4000Hz         Int?
  right8000Hz         Int?
  left250Hz           Int?
  left500Hz           Int?
  left1000Hz          Int?
  left2000Hz          Int?
  left4000Hz          Int?
  left8000Hz          Int?
  rightPta4           Float?
  leftPta4            Float?
  rightPta3           Float?
  leftPta3            Float?
  rightSpeechReceptionThreshold Int?
  leftSpeechReceptionThreshold  Int?
  rightSpeechDiscrimination   Int?
  leftSpeechDiscrimination    Int?
  rightHearingLossType  HearingLossType?
  leftHearingLossType   HearingLossType?
  rightHearingLossDegree String?
  leftHearingLossDegree  String?
  tympanogramRight    String?
  tympanogramLeft     String?
  acousticReflexRight String?
  acousticReflexLeft  String?
  oaeRight            String?
  oaeLeft             String?
  abrRecommended      Boolean         @default(false)
  hearingAidRecommended Boolean       @default(false)
  hearingAidType      String?
  followUpNeeded      Boolean         @default(false)
  followUpDate        DateTime?
  notes               String?         @db.Text
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  patient             Patient         @relation(fields: [patientId], references: [id])
  provider            User?           @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([testDate])
  @@map("ent_audiometry")
}

model EntNasalEndoscopy {
  id                  String    @id @default(cuid())
  patientId           String
  providerId          String
  procedureDate       DateTime
  indication          String    @db.Text
  anesthesia          String?   @default("Topical lidocaine 4%")
  nasalSeptum         String?
  turbinates          String?   @db.Text
  meatus              String?
  nasalPolyps         Boolean   @default(false)
  polypDescription    String?   @db.Text
  mucosa              String?
  discharge           String?
  adenoids            String?
  eustachianTubeOrifices String?
  nasopharynx         String?
  oropharynx          String?
  larynx              String?   @db.Text
  vocalCords          String?
  lesionsFound        Boolean   @default(false)
  lesionDescription   String?   @db.Text
  biopsiesTaken       Int       @default(0)
  biopsySites         String?
  photographsTaken    Boolean   @default(false)
  rigidScopeUsed      Boolean   @default(false)
  flexibleScopeUsed   Boolean   @default(true)
  findings            String?   @db.Text
  impression          String?   @db.Text
  recommendations     String?   @db.Text
  followUpWeeks       Int?
  notes               String?   @db.Text
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  patient             Patient   @relation(fields: [patientId], references: [id])
  provider            User      @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([procedureDate])
  @@map("ent_nasal_endoscopy")
}

// ============================================
// RADIOLOGY / PACS
// ============================================

enum ImagingModality {
  XRAY
  CT
  MRI
  ULTRASOUND
  MAMMOGRAPHY
  FLUOROSCOPY
  PET
  NUCLEAR_MEDICINE
  ANGIOGRAPHY
  DEXA
}

enum ImagingStudyStatus {
  ORDERED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum RadiologistReportStatus {
  DRAFT
  PENDING_VERIFICATION
  VERIFIED
  AMENDED
}

model ImagingStudy {
  id                String             @id @default(cuid())
  patientId         String
  patient           Patient            @relation(fields: [patientId], references: [id])
  accessionNumber   String             @unique
  studyInstanceUid  String?            @unique
  modality          ImagingModality
  studyDescription  String?
  bodyPart          String?
  referringPhysicianId String?
  referringPhysician User?             @relation(name: "ReferringPhysician", fields: [referringPhysicianId], references: [id])
  radiologistId     String?
  radiologist       User?              @relation(name: "Radiologist", fields: [radiologistId], references: [id])
  technicianId      String?
  technician        User?              @relation(name: "Technician", fields: [technicianId], references: [id])
  scheduledDate     DateTime?
  performedDate     DateTime?
  status            ImagingStudyStatus @default(ORDERED)
  priority          OrderPriority      @default(ROUTINE)
  clinicalHistory   String?            @db.Text
  indication        String?            @db.Text
  contrastUsed      Boolean            @default(false)
  contrastType      String?
  doseReport        String?            @db.Text
  numberOfSeries    Int                @default(0)
  numberOfInstances Int                @default(0)
  storageLocation   String?
  dicomUrl          String?
  notes             String?            @db.Text
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  series            DicomSeries[]
  reports           RadiologistReport[]

  @@index([patientId])
  @@index([accessionNumber])
  @@index([status])
  @@index([modality])
  @@index([scheduledDate])
  @@index([performedDate])
  @@map("imaging_studies")
}

model DicomSeries {
  id                String       @id @default(cuid())
  studyId           String
  study             ImagingStudy @relation(fields: [studyId], references: [id], onDelete: Cascade)
  seriesInstanceUid String       @unique
  seriesNumber      Int?
  modality          String?
  seriesDescription String?
  bodyPartExamined  String?
  protocolName      String?
  sliceThickness    Float?
  numberOfSlices    Int          @default(0)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  instances         DicomInstance[]

  @@index([studyId])
  @@index([seriesInstanceUid])
  @@map("dicom_series")
}

model DicomInstance {
  id                 String      @id @default(cuid())
  seriesId           String
  series             DicomSeries @relation(fields: [seriesId], references: [id], onDelete: Cascade)
  sopInstanceUid     String      @unique
  instanceNumber     Int?
  sopClassUid        String?
  filePath           String
  fileSize           Int?
  transferSyntaxUid  String?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt

  @@index([seriesId])
  @@index([sopInstanceUid])
  @@map("dicom_instances")
}

model RadiologistReport {
  id                String                 @id @default(cuid())
  studyId           String
  study             ImagingStudy           @relation(fields: [studyId], references: [id], onDelete: Cascade)
  radiologistId     String
  radiologist       User                   @relation(name: "ReportRadiologist", fields: [radiologistId], references: [id])
  verifyingRadiologistId String?
  verifyingRadiologist User?               @relation(name: "VerifyingRadiologist", fields: [verifyingRadiologistId], references: [id])
  status            RadiologistReportStatus @default(DRAFT)
  findings          String?                @db.Text
  impression        String?                @db.Text
  recommendations   String?                @db.Text
  comparisonStudyId String?
  criticalFindings  Boolean                @default(false)
  notificationSent  Boolean                @default(false)
  reportedAt        DateTime?
  verifiedAt        DateTime?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt

  @@index([studyId])
  @@index([radiologistId])
  @@index([status])
  @@index([reportedAt])
  @@map("radiologist_reports")
}

// ============================================
// EMERGENCY DEPARTMENT
// ============================================

enum EDVisitStatus {
  PENDING
  TRIAGE
  IN_PROGRESS
  UNDER_OBSERVATION
  WAITING_RESULTS
  READY_FOR_DISCHARGE
  DISCHARGED
  ADMITTED
  TRANSFERRED
  LEFT_WITHOUT_BEING_SEEN
  DECEASED
}

enum ESI {
  ESI_1
  ESI_2
  ESI_3
  ESI_4
  ESI_5
}

enum EDDisposition {
  DISCHARGE_HOME
  ADMIT_TO_WARD
  ADMIT_TO_ICU
  TRANSFER_TO_ANOTHER_HOSPITAL
  TRANSFER_TO_ANOTHER_ED
  LEAVE_AMA
  DEATH
}

model EDVisit {
  id                    String       @id @default(cuid())
  patientId             String
  patient               Patient      @relation(fields: [patientId], references: [id])
  visitNumber           String       @unique
  arrivalTime           DateTime
  chiefComplaint        String       @db.Text
  
  // Patient Information at Time of Visit
  arrivalMode           String?
  ageAtVisit            Int
  genderAtVisit         String
  
  // Triage Information
  triageLevel           ESI?
  triageTime            DateTime?
  triageNurseId         String?
  triageNurse           User?        @relation(name: "EDTriageNurse", fields: [triageNurseId], references: [id])
  
  // Vitals at Triage
  triageTemperature     Float?
  triageHeartRate       Int?
  triageRespiratoryRate Int?
  triageBloodPressure   String?
  triageOxygenSaturation Float?
  triagePainScore       Int?
  triageGlasgowComaScore Int?
  
  // Current Status
  currentStatus         EDVisitStatus @default(PENDING)
  
  // Provider Assignment
  assignedProviderId    String?
  assignedProvider      User?        @relation(name: "EDProvider", fields: [assignedProviderId], references: [id])
  
  // Location Tracking
  bedAssignment         String?
  bedAssignmentTime     DateTime?
  
  // Clinical Course
  historyOfPresentIllness String?    @db.Text
  physicalExamination   String?      @db.Text
  differentialDiagnosis String?      @db.Text
  finalDiagnosis        String?      @db.Text
  
  // Procedures and Tests
  labsOrdered           String?      @db.Text
  imagingOrdered        String?      @db.Text
  proceduresPerformed   String?      @db.Text
  medicationsGiven      String?      @db.Text
  
  // Times
  providerFirstContactTime DateTime?
  roomAssignmentTime    DateTime?
  firstLabResultsTime   DateTime?
  firstImagingResultsTime DateTime?
  dispositionDecisionTime DateTime?
  dischargeTime         DateTime?
  
  // Disposition
  disposition           EDDisposition?
  dispositionNotes      String?      @db.Text
  
  // Consultations
  consultationsRequested String?     @db.Text
  
  // Critical Events
  cardiacArrest         Boolean      @default(false)
  intubationPerformed   Boolean      @default(false)
  cprPerformed          Boolean      @default(false)
  
  // Follow-up
  followUpInstructions  String?      @db.Text
  followUpRecommended   Boolean      @default(false)
  followUpWithin        String?
  
  // Notes
  notes                 String?      @db.Text
  
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  // Relations
  triageEvents          EDTriage[]
  procedures            EDProcedure[]
  flowRecords           EDFlow[]

  @@index([patientId])
  @@index([visitNumber])
  @@index([arrivalTime])
  @@index([currentStatus])
  @@index([triageLevel])
  @@index([assignedProviderId])
  @@index([dischargeTime])
  @@map("ed_visits")
}

model EDTriage {
  id                    String   @id @default(cuid())
  visitId               String
  visit                 EDVisit  @relation(fields: [visitId], references: [id], onDelete: Cascade)
  triageNurseId         String
  triageNurse           User     @relation(name: "TriageNurse", fields: [triageNurseId], references: [id])
  
  triageTime            DateTime @default(now())
  triageLevel           ESI
  
  // Vitals
  temperature           Float?
  heartRate             Int?
  respiratoryRate       Int?
  bloodPressure         String?
  oxygenSaturation      Float?
  painScore             Int?
  weight                Float?
  height                Float?
  
  // Assessment
  chiefComplaint        String   @db.Text
  historyOfPresentIllness String? @db.Text
  
  // Risk Factors
  immunocompromised     Boolean  @default(false)
  pregnancyStatus       String?
  allergies             String?
  currentMedications    String?
  
  // Special Considerations
  psychiatricHold       Boolean  @default(false)
  isolationRequired     Boolean  @default(false)
  isolationType         String?
  
  // Triage Notes
  triageNotes           String?  @db.Text
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([visitId])
  @@index([triageNurseId])
  @@index([triageTime])
  @@index([triageLevel])
  @@map("ed_triages")
}

enum EDProcedureType {
  INTUBATION
  CENTRAL_LINE
  ARTERIAL_LINE
  CHEST_TUBE
  LUMBAR_PUNCTURE
  THORACENTESIS
  PARACENTESIS
  JOINT_ASPIRATION
  FRACTURE_REDUCTION
  SUTURING
  INCISION_DRAINAGE
  CARDIOVERSION
  DEFIBRILLATION
  CPR
  OTHER
}

model EDProcedure {
  id                    String          @id @default(cuid())
  visitId               String
  visit                 EDVisit         @relation(fields: [visitId], references: [id], onDelete: Cascade)
  procedureType         EDProcedureType
  
  // Timing
  procedureTime         DateTime
  
  // Provider
  performedById         String
  performedBy           User            @relation(name: "EDProcedureProvider", fields: [performedById], references: [id])
  assistedById          String?
  assistedBy            User?           @relation(name: "EDProcedureAssistant", fields: [assistedById], references: [id])
  
  // Procedure Details
  procedureDescription  String          @db.Text
  indication            String?         @db.Text
  complications         String?         @db.Text
  
  // Anesthesia/Sedation
  sedationUsed          Boolean         @default(false)
  sedationType          String?
  anesthesiaProviderId  String?
  
  // Outcome
  outcome               String?
  specimenCollected     Boolean         @default(false)
  specimenType          String?
  
  // Documentation
  notes                 String?         @db.Text
  
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  @@index([visitId])
  @@index([performedById])
  @@index([procedureTime])
  @@index([procedureType])
  @@map("ed_procedures")
}

enum EDFlowStatus {
  WAITING
  IN_TREATMENT
  AWAITING_RESULTS
  AWAITING_CONSULT
  AWAITING_BED
  DISPOSITION_DECIDED
}

model EDFlow {
  id                    String       @id @default(cuid())
  visitId               String
  visit                 EDVisit      @relation(fields: [visitId], references: [id], onDelete: Cascade)
  
  // Timestamp
  timestamp             DateTime     @default(now())
  
  // Status and Location
  status                EDFlowStatus
  location              String?
  
  // Provider
  providerId            String?
  provider              User?        @relation(name: "EDFlowProvider", fields: [providerId], references: [id])
  
  // Notes
  clinicalNotes         String?      @db.Text
  plan                  String?      @db.Text
  
  // Orders Status
  labsOrdered           Boolean      @default(false)
  imagingOrdered        Boolean      @default(false)
  medicationsOrdered    Boolean      @default(false)
  consultOrdered        Boolean      @default(false)
  
  // Results Status
  labResultsAvailable   Boolean      @default(false)
  imagingResultsAvailable Boolean    @default(false)
  
  // Time Tracking
  timeInThisStatus      Int?         // in minutes
  
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  @@index([visitId])
  @@index([timestamp])
  @@index([status])
  @@index([providerId])
  @@map("ed_flows")
}

// ============================================
// ICU / CRITICAL CARE
// ============================================

enum IcuAdmissionStatus {
  ADMITTED
  CRITICAL
  STABLE
  IMPROVING
  DETERIORATING
  DISCHARGED
  DECEASED
}

enum IcuAdmissionSource {
  ED
  OR
  WARD
  ANOTHER_HOSPITAL
  DIRECT_ADMISSION
}

enum VentilatorMode {
  AC_VC
  AC_PC
  SIMV
  CPAP
  PS
  BiPAP
  APRV
  PRVC
  OTHER
}

enum LineType {
  CENTRAL_LINE_IJ
  CENTRAL_LINE_SUBCLAVIAN
  CENTRAL_LINE_FEMORAL
  ARTERIAL_LINE_RADIAL
  ARTERIAL_LINE_FEMORAL
  PICC_LINE
  IO_LINE
  PERIPHERAL_IV
}

enum DrainType {
  CHEST_TUBE
  JP_DRAIN
  HEMOVAC
  FOLEY_CATHETER
  NG_TUBE
  OG_TUBE
  SURGICAL_DRAIN
  WOUND_VAC
}

model IcuAdmission {
  id              String              @id @default(cuid())
  patientId       String
  patient         Patient             @relation(fields: [patientId], references: [id])
  
  admissionNumber String              @unique
  admissionDate   DateTime
  admissionSource IcuAdmissionSource
  admittingProviderId String
  admittingProvider User              @relation(name: "IcuAdmittingProvider", fields: [admittingProviderId], references: [id])
  
  // Location
  bedId           String?
  bedNumber       String?
  
  // APACHE II Score
  apacheIIScore   Int?
  apacheIICalculatedAt DateTime?
  
  // Primary Diagnosis
  primaryDiagnosis String             @db.Text
  secondaryDiagnoses String?          @db.Text
  admissionReason String?              @db.Text
  
  // Status
  currentStatus   IcuAdmissionStatus   @default(ADMITTED)
  isVentilated    Boolean              @default(false)
  isSedated       Boolean              @default(false)
  isIsolated      Boolean              @default(false)
  isolationType   String?
  
  // Expected Length of Stay
  expectedLos     Int?                 // in hours
  
  // Discharge Information
  dischargeDate   DateTime?
  dischargeDisposition String?
  dischargeProviderId String?
  dischargeProvider User?              @relation(name: "IcuDischargeProvider", fields: [dischargeProviderId], references: [id])
  
  // Outcome
  icuLos          Int?                 // actual length of stay in hours
  hospitalLos     Int?
  diedInIcu       Boolean              @default(false)
  
  // Notes
  admissionNotes  String?              @db.Text
  dischargeNotes  String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  // Relations
  vitalSigns      IcuVitalSign[]
  ventilatorSettings VentilatorSetting[]
  sedationAssessments SedationAssessment[]
  linesTubesDrains LinesTubesDrains[]
  fluidBalances   FluidBalance[]
  flowsheets      IcuFlowsheet[]
  dailyGoals      IcuDailyGoal[]

  @@index([patientId])
  @@index([admissionNumber])
  @@index([admissionDate])
  @@index([currentStatus])
  @@index([admittingProviderId])
  @@map("icu_admissions")
}

model IcuVitalSign {
  id              String          @id @default(cuid())
  admissionId     String
  admission       IcuAdmission    @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  recordedAt      DateTime        @default(now())
  recordedById    String
  recordedBy      User            @relation(name: "IcuVitalsRecorder", fields: [recordedById], references: [id])
  
  // Vitals
  heartRate       Int?
  systolicBP      Int?
  diastolicBP     Int?
  meanArterialPressure Int?
  respiratoryRate Int?
  temperature     Float?
  oxygenSaturation Float?
  
  // GCS
  gcsEye          Int?            // 1-4
  gcsVerbal       Int?            // 1-5
  gcsMotor        Int?            // 1-6
  gcsTotal        Int?            // 3-15
  
  // Advanced Monitoring
  cvp             Int?            // Central Venous Pressure
  papSystolic     Int?            // Pulmonary Artery Pressure
  papDiastolic    Int?
  pcwp            Int?            // Pulmonary Capillary Wedge Pressure
  cardiacOutput   Float?
  cardiacIndex    Float?
  
  // Pain
  painScore       Int?            // 0-10
  
  // Critical Alerts
  isCritical      Boolean         @default(false)
  criticalAlerts  String?         @db.Text
  
  notes           String?         @db.Text
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([admissionId])
  @@index([recordedAt])
  @@index([isCritical])
  @@index([recordedById])
  @@map("icu_vital_signs")
}

model VentilatorSetting {
  id              String              @id @default(cuid())
  admissionId     String
  admission       IcuAdmission        @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  recordedAt      DateTime            @default(now())
  recordedById    String
  recordedBy      User                @relation(name: "VentSettingsRecorder", fields: [recordedById], references: [id])
  
  // Mode and Settings
  ventilatorMode  VentilatorMode
  fio2            Float               // 0.21 - 1.0
  peep            Int?                // cm H2O
  tidalVolume     Int?                // mL
  respiratoryRate Int?                // breaths/min
  pressureSupport Int?                // cm H2O
  peakPressure    Int?                // cm H2O
  plateauPressure Int?                // cm H2O
  
  // Advanced Settings
  ieRatio         String?             // I:E ratio (e.g., "1:2")
  inspiratoryTime Float?              // seconds
  flowRate        Int?                // L/min
  sensitivity     Int?                // cm H2O
  
  // Weaning Parameters
  rsbi            Float?              // Rapid Shallow Breathing Index
  nif             Int?                // Negative Inspiratory Force
  spontaneousVt   Int?                // mL
  spontaneousRate Int?
  
  // Status
  isExtubated     Boolean             @default(false)
  extubationDate  DateTime?
  extubationNotes String?             @db.Text
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([admissionId])
  @@index([recordedAt])
  @@index([isExtubated])
  @@index([recordedById])
  @@map("ventilator_settings")
}

model SedationAssessment {
  id              String              @id @default(cuid())
  admissionId     String
  admission       IcuAdmission        @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  assessedAt      DateTime            @default(now())
  assessedById    String
  assessedBy      User                @relation(name: "SedationAssessor", fields: [assessedById], references: [id])
  
  // RASS (Richmond Agitation-Sedation Scale)
  rassScore       Int                 // -5 to +4
  
  // CAM-ICU Delirium Screening
  camIcuPositive  Boolean?
  camIcuFeature1  Boolean?            // Acute onset or fluctuating course
  camIcuFeature2  Boolean?            // Inattention
  camIcuFeature3  Boolean?            // Disorganized thinking
  camIcuFeature4  Boolean?            // Altered level of consciousness
  
  // Pain Assessment
  painScore       Int?                // 0-10 or CPOT for intubated
  painScale       String?             // "NUMERIC", "CPOT", "BPS"
  
  // Sedation Medications
  sedationMedications String?         @db.Text
  sedationGoal    String?
  
  // Agitation/Delirium Management
  deliriumManagement String?          @db.Text
  restraintsUsed    Boolean           @default(false)
  restraintType     String?
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([admissionId])
  @@index([assessedAt])
  @@index([rassScore])
  @@index([camIcuPositive])
  @@index([assessedById])
  @@map("sedation_assessments")
}

model LinesTubesDrains {
  id              String              @id @default(cuid())
  admissionId     String
  admission       IcuAdmission        @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  // Line/Tube/Drain Information
  deviceType      String              // LINE, TUBE, or DRAIN
  deviceSubtype   String              // specific type
  
  // Insertion Details
  insertedAt      DateTime
  insertedById    String
  insertedBy      User                @relation(name: "LineInsertedBy", fields: [insertedById], references: [id])
  insertionSite   String?
  insertionNotes  String?             @db.Text
  
  // Specifications
  size            String?
  length          String?
  numberOfLumens  Int?
  
  // Maintenance
  dressingChangeDate DateTime?
  tubingChangeDate   DateTime?
  
  // Removal
  removedAt       DateTime?
  removedById     String?
  removedBy       User?               @relation(name: "LineRemovedBy", fields: [removedById], references: [id])
  removalReason   String?
  
  // Complications
  complications   String?             @db.Text
  infectionSigns  Boolean             @default(false)
  
  // Status
  isActive        Boolean             @default(true)
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([admissionId])
  @@index([insertedAt])
  @@index([isActive])
  @@index([insertedById])
  @@map("lines_tubes_drains")
}

model FluidBalance {
  id              String              @id @default(cuid())
  admissionId     String
  admission       IcuAdmission        @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  recordedAt      DateTime            @default(now())
  recordedById    String
  recordedBy      User                @relation(name: "FluidBalanceRecorder", fields: [recordedById], references: [id])
  
  // Time Period (usually hourly)
  periodStart     DateTime
  periodEnd       DateTime
  
  // Intake (mL)
  ivFluids        Int                 @default(0)
  enteralFeeds    Int                 @default(0)
  oralIntake      Int                 @default(0)
  bloodProducts   Int                 @default(0)
  medications     Int                 @default(0)
  otherIntake     Int                 @default(0)
  totalIntake     Int                 @default(0)
  
  // Output (mL)
  urineOutput     Int                 @default(0)
  ngTubeDrainage  Int                 @default(0)
  chestTubeDrainage Int               @default(0)
  stool           Int                 @default(0)
  woundDrainage   Int                 @default(0)
  otherOutput     Int                 @default(0)
  totalOutput     Int                 @default(0)
  
  // Balance
  balance         Int                 @default(0)
  cumulativeBalance Int               @default(0)
  
  // Urine Characteristics
  urineColor      String?
  urineClarity    String?
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([admissionId])
  @@index([recordedAt])
  @@index([recordedById])
  @@map("fluid_balances")
}

model IcuFlowsheet {
  id              String              @id @default(cuid())
  admissionId     String
  admission       IcuAdmission        @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  recordedAt      DateTime            @default(now())
  recordedById    String
  recordedBy      User                @relation(name: "FlowsheetRecorder", fields: [recordedById], references: [id])
  
  // Shift Information
  shift           String              // "DAY", "EVENING", "NIGHT"
  
  // Activity and Positioning
  activityLevel   String?
  position        String?
  turnsPerformed  Int                 @default(0)
  
  // Skin Assessment
  skinAssessment  String?             @db.Text
  pressureUlcerRisk String?
  
  // Safety
  fallRisk        String?
  restraintsChecked Boolean           @default(false)
  
  // Lines/Tubes Check
  linesChecked    Boolean             @default(false)
  tubesChecked    Boolean             @default(false)
  
  // Care Provided
  bathType        String?
  oralCare        Boolean             @default(false)
  eyeCare         Boolean             @default(false)
  
  // Family Communication
  familyUpdated   Boolean             @default(false)
  familyUpdateNotes String?           @db.Text
  
  // Events
  events          String?             @db.Text
  
  // Plan
  planForNextShift String?            @db.Text
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([admissionId])
  @@index([recordedAt])
  @@index([shift])
  @@index([recordedById])
  @@map("icu_flowsheets")
}

model IcuDailyGoal {
  id              String              @id @default(cuid())
  admissionId     String
  admission       IcuAdmission        @relation(fields: [admissionId], references: [id], onDelete: Cascade)
  
  goalDate        DateTime
  
  createdById     String
  createdBy       User                @relation(name: "DailyGoalCreator", fields: [createdById], references: [id])
  
  // Patient Status
  patientStatus   String?             @db.Text
  overnightEvents String?             @db.Text
  
  // Daily Goals
  ventilationGoal String?             @db.Text
  sedationGoal    String?             @db.Text
  mobilityGoal    String?             @db.Text
  nutritionGoal   String?             @db.Text
  
  // Liberation Goals
  liberationTrial Boolean             @default(false)
  liberationTrialTime DateTime?
  extubationGoal  Boolean             @default(false)
  
  // Prophylaxis
  dvtProphylaxis  Boolean             @default(false)
  pepticUlcerProphylaxis Boolean      @default(false)
  
  // Communication
  familyCommunication String?         @db.Text
  familyMeetingScheduled Boolean      @default(false)
  familyMeetingTime DateTime?
  
  // Discharge Planning
  dischargeAnticipatedDate DateTime?
  dischargeDispositionPlanned String?
  
  // Action Items
  actionItems     String?             @db.Text
  
  // Outcome
  goalsMet        Boolean?
  barriersToGoals String?             @db.Text
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([admissionId])
  @@index([goalDate])
  @@index([createdById])
  @@map("icu_daily_goals")
}

// ============================================
// BLOOD BANK
// ============================================

enum BloodTypeBB {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
}

enum BloodProductType {
  WHOLE_BLOOD
  PRBC
  FFP
  PLATELETS
  CRYOPRECIPITATE
  GRANULOCYTES
  ALBUMIN
  IVIG
}

enum BloodProductStatus {
  AVAILABLE
  RESERVED
  QUARANTINE
  EXPIRED
  DISCARDED
  TRANSFUSED
}

enum CrossMatchResult {
  COMPATIBLE
  INCOMPATIBLE
  INCONCLUSIVE
}

enum TransfusionStatus {
  ORDERED
  CROSSMATCHED
  READY
  IN_PROGRESS
  COMPLETED
  STOPPED
  REACTION
}

enum TransfusionReactionType {
  FEBRILE_NONHEMOLYTIC
  ACUTE_HEMOLYTIC
  DELAYED_HEMOLYTIC
  ALLERGIC_URTICARIA
  ANAPHYLAXIS
  TRALI
  TACO
  SEPSIS
  TA_GVHD
  POST_TRANSFUSION_PURPURA
}

model BloodDonor {
  id              String    @id @default(cuid())
  donorId         String    @unique
  firstName       String
  lastName        String
  dateOfBirth     DateTime
  gender          Gender
  bloodType       BloodTypeBB
  phone           String?
  email           String?
  address         String?
  
  // Screening
  medicalHistory  String?   @db.Text
  isEligible      Boolean   @default(true)
  deferralReason  String?
  deferralUntil   DateTime?
  
  // Last Donation
  lastDonationDate DateTime?
  totalDonations  Int       @default(0)
  
  // Emergency Contact
  emergencyContactName String?
  emergencyContactPhone String?
  
  isActive        Boolean   @default(true)
  notes           String?   @db.Text
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  donations       BloodDonation[]

  @@index([donorId])
  @@index([bloodType])
  @@index([isEligible])
  @@map("blood_donors")
}

model BloodDonation {
  id              String          @id @default(cuid())
  donorId         String
  donor           BloodDonor      @relation(fields: [donorId], references: [id])
  
  donationNumber  String          @unique
  donationDate    DateTime        @default(now())
  
  // Volume
  volumeCollected Int             // in mL
  bloodType       BloodTypeBB
  
  // Screening Tests
  hivTest         String?         // Negative, Positive, Pending
  hbvTest         String?
  hcvTest         String?
  syphilisTest    String?
  malariaTest     String?
  
  // Processing
  isProcessed     Boolean         @default(false)
  processedDate   DateTime?
  processedById   String?
  processedBy     User?           @relation(name: "BloodProcessedBy", fields: [processedById], references: [id])
  
  // Products Created
  products        BloodProduct[]
  
  // Status
  isQualified     Boolean         @default(false)
  disqualificationReason String?
  
  notes           String?         @db.Text
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([donorId])
  @@index([donationNumber])
  @@index([donationDate])
  @@index([isQualified])
  @@map("blood_donations")
}

model BloodProduct {
  id              String              @id @default(cuid())
  
  // Identification
  productCode     String              @unique
  productType     BloodProductType
  bloodType       BloodTypeBB
  
  // Source
  donationId      String
  donation        BloodDonation       @relation(fields: [donationId], references: [id])
  
  // Volume
  volume          Int                 // in mL
  
  // Dates
  collectionDate  DateTime
  expirationDate  DateTime
  
  // Storage
  storageLocation String?
  storageTemp     Float?              // in Celsius
  
  // Status
  status          BloodProductStatus  @default(QUARANTINE)
  
  // Reserved For
  reservedForId   String?
  reservedFor     Patient?            @relation(name: "BloodReservedFor", fields: [reservedForId], references: [id])
  reservedUntil   DateTime?
  
  // Relations
  crossMatches    CrossMatch[]
  transfusions    BloodTransfusion[]
  
  // Quality Control
  qcPassed        Boolean             @default(false)
  qcDate          DateTime?
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([productCode])
  @@index([productType])
  @@index([bloodType])
  @@index([status])
  @@index([expirationDate])
  @@index([reservedForId])
  @@map("blood_products")
}

model CrossMatch {
  id              String              @id @default(cuid())
  
  // Patient
  patientId       String
  patient         Patient             @relation(fields: [patientId], references: [id])
  
  // Blood Product
  productId       String
  product         BloodProduct        @relation(fields: [productId], references: [id])
  
  // Testing
  testDate        DateTime            @default(now())
  testedById      String
  testedBy        User                @relation(name: "CrossMatchTester", fields: [testedById], references: [id])
  
  // Compatibility Testing
  majorCrossMatch CrossMatchResult
  minorCrossMatch CrossMatchResult
  antibodyScreen  String?
  
  // Results
  isCompatible    Boolean
  incompatibilityReason String?
  
  // Validity
  validUntil      DateTime?
  
  notes           String?             @db.Text
  
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([patientId])
  @@index([productId])
  @@index([testDate])
  @@index([isCompatible])
  @@map("cross_matches")
}

model BloodTransfusion {
  id              String                  @id @default(cuid())
  
  // Order Information
  orderNumber     String                  @unique
  patientId       String
  patient         Patient                 @relation(fields: [patientId], references: [id])
  
  orderingProviderId String
  orderingProvider User                   @relation(name: "TransfusionOrderedBy", fields: [orderingProviderId], references: [id])
  
  // Product
  productId       String
  product         BloodProduct            @relation(fields: [productId], references: [id])
  
  // Indication
  indication      String                  @db.Text
  hemoglobin      Float?
  plateletCount   Int?
  inr             Float?
  
  // Vital Signs Pre-Transfusion
  preTemp         Float?
  preHr           Int?
  preBp           String?
  preRr           Int?
  
  // Administration
  startedAt       DateTime?
  startedById     String?
  startedBy       User?                   @relation(name: "TransfusionStartedBy", fields: [startedById], references: [id])
  
  completedAt     DateTime?
  completedById   String?
  completedBy     User?                   @relation(name: "TransfusionCompletedBy", fields: [completedById], references: [id])
  
  // Status
  status          TransfusionStatus       @default(ORDERED)
  
  // Reactions
  reactionOccurred Boolean                 @default(false)
  reactionType    TransfusionReactionType?
  reactionTime    DateTime?
  reactionDetails String?                 @db.Text
  stoppedReason   String?
  
  // Vital Signs Post-Transfusion
  postTemp        Float?
  postHr          Int?
  postBp          String?
  postRr          Int?
  
  // Follow-up
  hemoglobinPost  Float?
  
  notes           String?                 @db.Text
  
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  @@index([patientId])
  @@index([productId])
  @@index([orderNumber])
  @@index([status])
  @@index([startedAt])
  @@map("blood_transfusions")
}

// ============================================
// INVENTORY / SUPPLY CHAIN
// ============================================

enum InventoryItemCategory {
  MEDICAL_SUPPLIES
  PHARMACEUTICALS
  LABORATORY_SUPPLIES
  SURGICAL_SUPPLIES
  DURABLE_MEDICAL_EQUIPMENT
  OFFICE_SUPPLIES
  LINEN
  NUTRITION
  RADIOLOGY_SUPPLIES
  GENERAL
}

enum InventoryItemStatus {
  ACTIVE
  INACTIVE
  DISCONTINUED
  ON_BACKORDER
}

enum InventoryTransactionType {
  RECEIPT
  ISSUE
  RETURN
  ADJUSTMENT
  TRANSFER_IN
  TRANSFER_OUT
  WASTE
  EXPIRED
  RECALLED
  COUNT
}

enum PurchaseOrderStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT_TO_SUPPLIER
  PARTIALLY_RECEIVED
  RECEIVED
  CANCELLED
  CLOSED
}

enum RequisitionStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  FULFILLED
  PARTIALLY_FULFILLED
  CANCELLED
  REJECTED
}

model InventoryItem {
  id              String               @id @default(cuid())
  
  // Basic Info
  sku             String               @unique
  name            String
  description     String?              @db.Text
  manufacturer    String?
  modelNumber     String?
  barcode         String?              @unique
  
  // Classification
  category        InventoryItemCategory
  subCategory     String?
  
  // Unit of Measure
  unitOfMeasure   String               // e.g., "each", "box", "case", "ml", "mg"
  unitsPerPackage Int                  @default(1)
  
  // Stock Control
  reorderPoint    Int                  @default(0)
  reorderQuantity Int                  @default(1)
  maxStockLevel   Int?
  minStockLevel   Int                  @default(0)
  
  // Pricing
  unitCost        Decimal              @db.Decimal(10, 2)
  averageCost     Decimal              @db.Decimal(10, 2) @default(0)
  lastCost        Decimal              @db.Decimal(10, 2) @default(0)
  
  // Tracking
  isLotTracked    Boolean              @default(false)
  isSerialized    Boolean              @default(false)
  isExpirable     Boolean              @default(false)
  
  // Storage
  defaultLocation String?
  storageTempMin  Float?
  storageTempMax  Float?
  specialHandling String?
  
  // Status
  status          InventoryItemStatus  @default(ACTIVE)
  
  // Regulatory
  hcpcsCode       String?
  ndcNumber       String?
  cptCode         String?
  
  // Relations
  stock           InventoryStock[]
  transactions    InventoryTransaction[]
  poItems         PurchaseOrderItem[]
  requisitionItems RequisitionItem[]
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([sku])
  @@index([category])
  @@index([status])
  @@index([barcode])
  @@map("inventory_items")
}

model InventoryLocation {
  id              String               @id @default(cuid())
  
  // Location Info
  code            String               @unique
  name            String
  description     String?
  
  // Hierarchy
  locationType    String               // e.g., "WAREHOUSE", "PHARMACY", "FLOOR", "DEPARTMENT", "ROOM"
  parentLocationId String?
  parentLocation  InventoryLocation?   @relation("LocationHierarchy", fields: [parentLocationId], references: [id])
  childLocations  InventoryLocation[]  @relation("LocationHierarchy")
  
  // Department Assignment
  departmentId    String?
  
  // Storage Properties
  isTemperatureControlled Boolean      @default(false)
  temperatureMin  Float?
  temperatureMax  Float?
  isSecure        Boolean              @default(false)
  isActive        Boolean              @default(true)
  
  // Relations
  stock           InventoryStock[]
  transactionsFrom InventoryTransaction[] @relation("FromLocation")
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([code])
  @@index([locationType])
  @@index([departmentId])
  @@map("inventory_locations")
}

model InventoryStock {
  id              String               @id @default(cuid())
  
  // Item
  itemId          String
  item            InventoryItem        @relation(fields: [itemId], references: [id])
  
  // Location
  locationId      String
  location        InventoryLocation    @relation(fields: [locationId], references: [id])
  
  // Quantity
  quantityOnHand  Int                  @default(0)
  quantityReserved Int                 @default(0)
  quantityAvailable Int                @default(0)
  
  // Lot/Serial Info (for tracked items)
  lotNumber       String?
  serialNumber    String?
  expirationDate  DateTime?
  receivedDate    DateTime?
  
  // Cost
  unitCost        Decimal              @db.Decimal(10, 2)
  
  // Status
  isQuarantine    Boolean              @default(false)
  quarantineReason String?
  isExpired       Boolean              @default(false)
  
  // Relations
  transactions    InventoryTransaction[]
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@unique([itemId, locationId, lotNumber, serialNumber])
  @@index([itemId])
  @@index([locationId])
  @@index([lotNumber])
  @@index([serialNumber])
  @@index([expirationDate])
  @@index([isExpired])
  @@map("inventory_stock")
}

model InventoryTransaction {
  id              String                   @id @default(cuid())
  
  // Transaction Info
  transactionNumber String                 @unique
  transactionType InventoryTransactionType
  transactionDate DateTime                 @default(now())
  
  // Item
  itemId          String
  item            InventoryItem            @relation(fields: [itemId], references: [id])
  
  // Stock Reference
  stockId         String?
  stock           InventoryStock?          @relation(fields: [stockId], references: [id])
  
  // Location
  fromLocationId  String?
  fromLocation    InventoryLocation?       @relation(name: "FromLocation", fields: [fromLocationId], references: [id])
  toLocationId    String?
  
  // Quantity
  quantity        Int
  unitCost        Decimal                  @db.Decimal(10, 2)
  totalCost       Decimal                  @db.Decimal(10, 2)
  
  // Reference Documents
  referenceType   String?                  // e.g., "PO", "REQUISITION", "ADJUSTMENT", "TRANSFER"
  referenceId     String?
  referenceNumber String?
  
  // User
  performedById   String
  performedBy     User                     @relation(name: "InventoryTransactionPerformer", fields: [performedById], references: [id])
  
  // Lot/Serial
  lotNumber       String?
  serialNumber    String?
  expirationDate  DateTime?
  
  // Reason
  reason          String?
  notes           String?                  @db.Text
  
  createdAt       DateTime                 @default(now())

  @@index([transactionNumber])
  @@index([itemId])
  @@index([transactionType])
  @@index([transactionDate])
  @@index([fromLocationId])
  @@index([referenceType])
  @@map("inventory_transactions")
}

model Supplier {
  id              String               @id @default(cuid())
  
  // Basic Info
  code            String               @unique
  name            String
  contactPerson   String?
  
  // Address
  address         String?
  city            String?
  state           String?
  zipCode         String?
  country         String               @default("USA")
  
  // Contact
  phone           String?
  email           String?
  fax             String?
  website         String?
  
  // Business Info
  taxId           String?
  paymentTerms    String?              // e.g., "Net 30", "Net 60"
  currency        String               @default("USD")
  
  // Status
  isActive        Boolean              @default(true)
  isPreferred     Boolean              @default(false)
  
  // Ratings
  rating          Int?                 @db.TinyInt
  performanceScore Float?
  
  // Relations
  purchaseOrders  PurchaseOrder[]
  itemsSupplied   SupplierItem[]
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([code])
  @@index([isActive])
  @@index([isPreferred])
  @@map("suppliers")
}

model SupplierItem {
  id              String               @id @default(cuid())
  
  supplierId      String
  supplier        Supplier             @relation(fields: [supplierId], references: [id])
  
  itemId          String
  
  // Supplier-specific info
  supplierSku     String?
  supplierName    String?
  
  // Pricing
  unitCost        Decimal              @db.Decimal(10, 2)
  minOrderQty     Int                  @default(1)
  leadTimeDays    Int?
  
  // Status
  isPrimary       Boolean              @default(false)
  isActive        Boolean              @default(true)
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@unique([supplierId, itemId])
  @@index([supplierId])
  @@index([itemId])
  @@map("supplier_items")
}

model PurchaseOrder {
  id              String               @id @default(cuid())
  
  // Order Info
  poNumber        String               @unique
  poDate          DateTime             @default(now())
  
  // Supplier
  supplierId      String
  supplier        Supplier             @relation(fields: [supplierId], references: [id])
  
  // Status
  status          PurchaseOrderStatus  @default(DRAFT)
  
  // Financials
  subtotal        Decimal              @db.Decimal(10, 2) @default(0)
  taxAmount       Decimal              @db.Decimal(10, 2) @default(0)
  shippingAmount  Decimal              @db.Decimal(10, 2) @default(0)
  discountAmount  Decimal              @db.Decimal(10, 2) @default(0)
  totalAmount     Decimal              @db.Decimal(10, 2) @default(0)
  
  // Delivery
  expectedDeliveryDate DateTime?
  deliveryLocationId String?
  
  // Approval
  requestedById   String
  requestedBy     User                 @relation(name: "PORequestedBy", fields: [requestedById], references: [id])
  approvedById    String?
  approvedBy      User?                @relation(name: "POApprovedBy", fields: [approvedById], references: [id])
  approvedAt      DateTime?
  
  // Receipt
  receivedDate    DateTime?
  
  // Relations
  items           PurchaseOrderItem[]
  
  notes           String?              @db.Text
  terms           String?
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([poNumber])
  @@index([supplierId])
  @@index([status])
  @@index([poDate])
  @@index([expectedDeliveryDate])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String               @id @default(cuid())
  
  // Order
  purchaseOrderId String
  purchaseOrder   PurchaseOrder        @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  
  // Item
  itemId          String
  item            InventoryItem        @relation(fields: [itemId], references: [id])
  
  // Quantity
  quantityOrdered Int
  quantityReceived Int                 @default(0)
  quantityBackordered Int              @default(0)
  
  // Pricing
  unitCost        Decimal              @db.Decimal(10, 2)
  totalCost       Decimal              @db.Decimal(10, 2)
  
  // Status
  isReceived      Boolean              @default(false)
  
  // Delivery
  expectedDeliveryDate DateTime?
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([purchaseOrderId])
  @@index([itemId])
  @@map("purchase_order_items")
}

model Requisition {
  id              String               @id @default(cuid())
  
  // Requisition Info
  reqNumber       String               @unique
  reqDate         DateTime             @default(now())
  
  // Requester
  departmentId    String
  requestedById   String
  requestedBy     User                 @relation(name: "RequisitionRequestedBy", fields: [requestedById], references: [id])
  
  // Priority
  priority        String               @default("NORMAL") // LOW, NORMAL, HIGH, URGENT
  neededByDate    DateTime?
  
  // Status
  status          RequisitionStatus    @default(DRAFT)
  
  // Approval
  approvedById    String?
  approvedBy      User?                @relation(name: "RequisitionApprovedBy", fields: [approvedById], references: [id])
  approvedAt      DateTime?
  approvalNotes   String?
  
  // Fulfillment
  fulfilledById   String?
  fulfilledBy     User?                @relation(name: "RequisitionFulfilledBy", fields: [fulfilledById], references: [id])
  fulfilledAt     DateTime?
  
  // Relations
  items           RequisitionItem[]
  
  notes           String?              @db.Text
  justification   String?
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([reqNumber])
  @@index([departmentId])
  @@index([status])
  @@index([priority])
  @@index([reqDate])
  @@map("requisitions")
}

model RequisitionItem {
  id              String               @id @default(cuid())
  
  // Requisition
  requisitionId   String
  requisition     Requisition          @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  
  // Item
  itemId          String
  item            InventoryItem        @relation(fields: [itemId], references: [id])
  
  // Quantity
  quantityRequested Int
  quantityApproved Int?
  quantityIssued  Int                  @default(0)
  
  // Status
  isFulfilled     Boolean              @default(false)
  
  // Substitution
  substituteItemId String?
  substitutionApproved Boolean         @default(false)
  
  notes           String?              @db.Text
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([requisitionId])
  @@index([itemId])
  @@map("requisition_items")
}

model AiChatSession {
  id             String          @id @default(cuid())
  userId         String
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  lastActivityAt DateTime        @default(now())
  messages       AiChatMessage[]

  @@index([userId, isActive])
  @@index([lastActivityAt])
  @@map("ai_chat_sessions")
}

model AiChatMessage {
  id        String        @id @default(cuid())
  sessionId String
  session   AiChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  sequence  Int
  payload   Json
  createdAt DateTime      @default(now())

  @@unique([sessionId, sequence])
  @@index([sessionId])
  @@map("ai_chat_messages")
}
