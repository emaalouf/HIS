generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  DOCTOR
  NURSE
  RECEPTIONIST
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum BloodType {
  A_POSITIVE
  A_NEGATIVE
  B_POSITIVE
  B_NEGATIVE
  AB_POSITIVE
  AB_NEGATIVE
  O_POSITIVE
  O_NEGATIVE
  UNKNOWN
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  role          Role      @default(RECEPTIONIST)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  departmentId  String?

  // Relations
  medicalHistories MedicalHistory[]
  uploadedDocuments PatientDocument[]
  appointmentsCreated Appointment[] @relation("AppointmentCreatedBy")
  appointmentsAsProvider Appointment[] @relation("AppointmentProvider")
  encountersCreated Encounter[] @relation("EncounterCreatedBy")
  encountersAsProvider Encounter[] @relation("EncounterProvider")
  department Department? @relation("DepartmentUsers", fields: [departmentId], references: [id])
  dialysisSessions DialysisSession[]
  dialysisPrescriptions DialysisPrescription[]
  dialysisSchedules DialysisSchedule[]
  cardiologyVisits CardiologyVisit[]
  cardiologyEcgs CardiologyEcg[]
  cardiologyEchos CardiologyEcho[]
  cardiologyStressTests CardiologyStressTest[]
  cardiologyProcedures CardiologyProcedure[]
  cardiologyDevices CardiologyDevice[]
  cardiologyMedicationOrders CardiologyMedicationOrder[]
  nephrologyVisits NephrologyVisit[]
  nephrologyImagingStudies NephrologyImaging[]
  nephrologyBiopsies NephrologyBiopsy[]
  nephrologyMedicationOrders NephrologyMedicationOrder[]
  neurologyVisits NeurologyVisit[]
  clinicalOrders ClinicalOrder[]
  medicationOrders MedicationOrder[]
  medicationAdministrations MedicationAdministration[]
  invoicesCreated Invoice[]
  paymentsReceived Payment[]
  admissions Admission[]

  @@map("users")
}

model Patient {
  id                      String    @id @default(cuid())
  mrn                     String    @unique // Medical Record Number
  
  // Demographics
  firstName               String
  lastName                String
  dateOfBirth             DateTime
  gender                  Gender
  bloodType               BloodType @default(UNKNOWN)
  
  // Contact Information
  email                   String?
  phone                   String
  address                 String?   @db.Text
  city                    String?
  country                 String?
  
  // Emergency Contact
  emergencyContactName    String?
  emergencyContactPhone   String?
  emergencyContactRelation String?
  
  // Medical Information
  allergies               Json      @default("[]")
  chronicConditions       Json      @default("[]")
  
  // Status
  isActive                Boolean   @default(true)
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  // Relations
  medicalHistories        MedicalHistory[]
  documents               PatientDocument[]
  appointments            Appointment[]
  encounters              Encounter[]
  dialysisSessions        DialysisSession[]
  dialysisPrescriptions   DialysisPrescription[]
  dialysisSchedules       DialysisSchedule[]
  dialysisLabResults       DialysisLabResult[]
  dialysisMedicationOrders DialysisMedicationOrder[]
  cardiologyVisits         CardiologyVisit[]
  cardiologyEcgs           CardiologyEcg[]
  cardiologyEchos          CardiologyEcho[]
  cardiologyStressTests    CardiologyStressTest[]
  cardiologyProcedures     CardiologyProcedure[]
  cardiologyDevices        CardiologyDevice[]
  cardiologyMedicationOrders CardiologyMedicationOrder[]
  cardiologyLabResults       CardiologyLabResult[]
  nephrologyVisits           NephrologyVisit[]
  nephrologyLabResults       NephrologyLabResult[]
  nephrologyImagingStudies   NephrologyImaging[]
  nephrologyBiopsies         NephrologyBiopsy[]
  nephrologyMedicationOrders NephrologyMedicationOrder[]
  neurologyVisits            NeurologyVisit[]
  clinicalOrders             ClinicalOrder[]
  clinicalResults            ClinicalResult[]
  medicationOrders           MedicationOrder[]
  medicationAdministrations  MedicationAdministration[]
  invoices                   Invoice[]
  payments                   Payment[]
  claims                     Claim[]
  admissions                 Admission[]

  @@map("patients")
}

model MedicalHistory {
  id          String    @id @default(cuid())
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  diagnosis   String    @db.Text
  treatment   String?   @db.Text
  notes       String?   @db.Text
  visitDate   DateTime
  
  doctorId    String
  doctor      User      @relation(fields: [doctorId], references: [id])
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([patientId])
  @@index([doctorId])
  @@map("medical_histories")
}

model PatientDocument {
  id          String    @id @default(cuid())
  patientId   String
  patient     Patient   @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  fileName    String
  fileType    String
  filePath    String
  fileSize    Int
  
  uploadedById String
  uploadedBy   User     @relation(fields: [uploadedById], references: [id])
  
  uploadedAt  DateTime  @default(now())

  @@index([patientId])
  @@index([uploadedById])
  @@map("patient_documents")
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  CHECKED_IN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum DialysisStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DialysisStationStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  OUT_OF_SERVICE
}

enum DialysisScheduleRecurrence {
  NONE
  DAILY
  WEEKLY
  MONTHLY
}

enum DialysisMedicationRoute {
  IV
  PO
  IM
  SC
  OTHER
}

enum CardiologyVisitStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CardiologyTestStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CardiologyProcedureStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum CardiologyDeviceStatus {
  ACTIVE
  INACTIVE
  REMOVED
}

enum CardiologyMedicationRoute {
  IV
  PO
  IM
  SC
  SL
  OTHER
}

enum NephrologyVisitStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NephrologyTestStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NeurologyVisitStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum EncounterStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OrderType {
  LAB
  IMAGING
  MEDICATION
  PROCEDURE
  OTHER
}

enum OrderStatus {
  ORDERED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OrderPriority {
  ROUTINE
  URGENT
  STAT
}

enum ResultStatus {
  PENDING
  FINAL
  AMENDED
}

enum ResultFlag {
  NORMAL
  ABNORMAL
  CRITICAL
}

enum MedicationOrderStatus {
  ACTIVE
  ON_HOLD
  COMPLETED
  DISCONTINUED
}

enum MedicationRoute {
  IV
  PO
  IM
  SC
  SL
  INHALATION
  TOPICAL
  OTHER
}

enum MedicationAdministrationStatus {
  GIVEN
  HELD
  REFUSED
  MISSED
}

enum InvoiceStatus {
  DRAFT
  ISSUED
  SUBMITTED
  PARTIAL
  PAID
  DENIED
  VOID
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
  CHECK
  OTHER
}

enum ClaimStatus {
  DRAFT
  SUBMITTED
  ACCEPTED
  DENIED
  PAID
}

enum AdmissionStatus {
  ADMITTED
  TRANSFERRED
  DISCHARGED
  CANCELLED
}

enum BedStatus {
  AVAILABLE
  OCCUPIED
  CLEANING
  MAINTENANCE
}

enum NephrologyProcedureStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum NephrologyMedicationRoute {
  IV
  PO
  IM
  SC
  SL
  OTHER
}

enum CkdStage {
  STAGE_1
  STAGE_2
  STAGE_3A
  STAGE_3B
  STAGE_4
  STAGE_5
  ESRD
}

enum NephrologyImagingModality {
  ULTRASOUND
  CT
  MRI
  XRAY
  NUCLEAR
  OTHER
}

model Department {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  locations   Location[]
  users       User[]   @relation("DepartmentUsers")
  wards       Ward[]
  admissions  Admission[]

  @@map("departments")
}

model Location {
  id           String    @id @default(cuid())
  name         String
  type         String?
  departmentId String?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  department   Department? @relation(fields: [departmentId], references: [id])
  appointments Appointment[]

  @@map("locations")
}

model VisitType {
  id              String   @id @default(cuid())
  name            String   @unique
  description     String?
  durationMinutes Int      @default(30)
  isTelehealth    Boolean  @default(false)
  color           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  appointments    Appointment[]

  @@map("visit_types")
}

model Appointment {
  id            String            @id @default(cuid())
  patientId     String
  providerId    String
  createdById   String
  visitTypeId   String?
  locationId    String?
  startTime     DateTime
  endTime       DateTime
  status        AppointmentStatus @default(SCHEDULED)
  reason        String?
  notes         String?
  cancellationReason String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  patient     Patient   @relation(fields: [patientId], references: [id])
  provider    User      @relation("AppointmentProvider", fields: [providerId], references: [id])
  createdBy   User      @relation("AppointmentCreatedBy", fields: [createdById], references: [id])
  visitType   VisitType? @relation(fields: [visitTypeId], references: [id])
  location    Location?  @relation(fields: [locationId], references: [id])
  encounter   Encounter?

  @@index([patientId])
  @@index([providerId])
  @@index([startTime])
  @@index([status])
  @@map("appointments")
}

model DialysisSession {
  id                     String         @id @default(cuid())
  patientId              String
  providerId             String
  status                 DialysisStatus @default(SCHEDULED)
  startTime              DateTime
  endTime                DateTime
  machineNumber          String?
  accessType             String?
  dialyzer               String?
  dialysate              String?
  bloodFlowRate          Int?
  dialysateFlowRate      Int?
  ultrafiltrationVolume  Float?
  weightPre              Float?
  weightPost             Float?
  notes                  String?        @db.Text
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt

  patient                Patient        @relation(fields: [patientId], references: [id])
  provider               User           @relation(fields: [providerId], references: [id])
  flowsheetEntries       DialysisFlowsheetEntry[]

  @@index([patientId])
  @@index([providerId])
  @@index([startTime])
  @@index([status])
  @@map("dialysis_sessions")
}

model DialysisPrescription {
  id                     String   @id @default(cuid())
  patientId              String
  providerId             String?
  dryWeight              Float?
  targetUltrafiltration  Float?
  durationMinutes        Int?
  dialyzer               String?
  dialysate              String?
  bloodFlowRate          Int?
  dialysateFlowRate      Int?
  accessType             String?
  frequency              String?
  isActive               Boolean  @default(true)
  notes                  String?  @db.Text
  startDate              DateTime?
  endDate                DateTime?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  patient                Patient  @relation(fields: [patientId], references: [id])
  provider               User?    @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([isActive])
  @@map("dialysis_prescriptions")
}

model DialysisFlowsheetEntry {
  id                     String   @id @default(cuid())
  sessionId              String
  recordedAt             DateTime
  bpSystolic             Int?
  bpDiastolic            Int?
  heartRate              Int?
  temperature            Float?
  oxygenSaturation       Int?
  bloodFlowRate          Int?
  dialysateFlowRate      Int?
  ultrafiltrationVolume  Float?
  arterialPressure       Int?
  venousPressure         Int?
  transmembranePressure  Int?
  alarms                 String?  @db.Text
  notes                  String?  @db.Text
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  session                DialysisSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([recordedAt])
  @@map("dialysis_flowsheet_entries")
}

model DialysisStation {
  id               String                @id @default(cuid())
  name             String
  room             String?
  machineNumber    String?
  status           DialysisStationStatus @default(AVAILABLE)
  lastServiceDate  DateTime?
  nextServiceDate  DateTime?
  notes            String?               @db.Text
  isActive         Boolean               @default(true)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt

  schedules        DialysisSchedule[]

  @@map("dialysis_stations")
}

model DialysisSchedule {
  id               String                     @id @default(cuid())
  patientId        String
  providerId       String?
  stationId        String?
  startTime        DateTime
  durationMinutes  Int
  recurrence       DialysisScheduleRecurrence @default(NONE)
  daysOfWeek       Json                       @default("[]")
  endDate          DateTime?
  isActive         Boolean                    @default(true)
  notes            String?                    @db.Text
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt

  patient          Patient                    @relation(fields: [patientId], references: [id])
  provider         User?                      @relation(fields: [providerId], references: [id])
  station          DialysisStation?           @relation(fields: [stationId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([stationId])
  @@index([startTime])
  @@map("dialysis_schedules")
}

model DialysisLabResult {
  id              String   @id @default(cuid())
  patientId       String
  collectedAt     DateTime
  ktv             Float?
  urr             Float?
  hemoglobin      Float?
  potassium       Float?
  sodium          Float?
  calcium         Float?
  phosphorus      Float?
  bicarbonate     Float?
  albumin         Float?
  creatinine      Float?
  notes           String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  patient         Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([collectedAt])
  @@map("dialysis_lab_results")
}

model DialysisMedicationOrder {
  id                String                   @id @default(cuid())
  patientId         String
  medicationName    String
  dose              String?
  route             DialysisMedicationRoute?
  frequency         String?
  startDate         DateTime?
  endDate           DateTime?
  lastAdministeredAt DateTime?
  isActive          Boolean                  @default(true)
  notes             String?                  @db.Text
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt

  patient           Patient                  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([isActive])
  @@map("dialysis_medication_orders")
}

model CardiologyVisit {
  id           String                @id @default(cuid())
  patientId    String
  providerId   String
  status       CardiologyVisitStatus @default(SCHEDULED)
  visitDate    DateTime
  reason       String?               @db.Text
  symptoms     String?               @db.Text
  diagnosis    String?               @db.Text
  assessment   String?               @db.Text
  plan         String?               @db.Text
  notes        String?               @db.Text
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt

  patient      Patient               @relation(fields: [patientId], references: [id])
  provider     User                  @relation(fields: [providerId], references: [id])
  ecgs         CardiologyEcg[]
  echos        CardiologyEcho[]
  stressTests  CardiologyStressTest[]
  procedures   CardiologyProcedure[]

  @@index([patientId])
  @@index([providerId])
  @@index([visitDate])
  @@index([status])
  @@map("cardiology_visits")
}

model CardiologyEcg {
  id             String               @id @default(cuid())
  patientId      String
  providerId     String?
  visitId        String?
  status         CardiologyTestStatus @default(ORDERED)
  recordedAt     DateTime
  type           String?
  rhythm         String?
  heartRate      Int?
  prInterval     Int?
  qrsDuration    Int?
  qtInterval     Int?
  qtc            Int?
  interpretation String?              @db.Text
  notes          String?              @db.Text
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt

  patient        Patient              @relation(fields: [patientId], references: [id])
  provider       User?                @relation(fields: [providerId], references: [id])
  visit          CardiologyVisit?     @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([recordedAt])
  @@index([status])
  @@map("cardiology_ecgs")
}

model CardiologyEcho {
  id                 String               @id @default(cuid())
  patientId          String
  providerId         String?
  visitId            String?
  status             CardiologyTestStatus @default(ORDERED)
  performedAt        DateTime
  type               String?
  lvef               Float?
  lvEndDiastolicDia  Float?
  lvEndSystolicDia   Float?
  rvFunction         String?
  valveFindings      String?              @db.Text
  wallMotion         String?              @db.Text
  pericardialEffusion Boolean?
  summary            String?              @db.Text
  notes              String?              @db.Text
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt

  patient            Patient              @relation(fields: [patientId], references: [id])
  provider           User?                @relation(fields: [providerId], references: [id])
  visit              CardiologyVisit?     @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("cardiology_echos")
}

model CardiologyStressTest {
  id               String               @id @default(cuid())
  patientId        String
  providerId       String?
  visitId          String?
  status           CardiologyTestStatus @default(ORDERED)
  performedAt      DateTime
  type             String?
  protocol         String?
  durationMinutes  Int?
  mets             Float?
  maxHeartRate     Int?
  maxBpSystolic    Int?
  maxBpDiastolic   Int?
  symptoms         String?              @db.Text
  result           String?              @db.Text
  notes            String?              @db.Text
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt

  patient          Patient              @relation(fields: [patientId], references: [id])
  provider         User?                @relation(fields: [providerId], references: [id])
  visit            CardiologyVisit?     @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("cardiology_stress_tests")
}

model CardiologyProcedure {
  id             String                   @id @default(cuid())
  patientId      String
  providerId     String?
  visitId        String?
  status         CardiologyProcedureStatus @default(SCHEDULED)
  procedureDate  DateTime
  type           String?
  indication     String?                  @db.Text
  findings       String?                  @db.Text
  complications  String?                  @db.Text
  outcome        String?                  @db.Text
  notes          String?                  @db.Text
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt

  patient        Patient                  @relation(fields: [patientId], references: [id])
  provider       User?                    @relation(fields: [providerId], references: [id])
  visit          CardiologyVisit?         @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([procedureDate])
  @@index([status])
  @@map("cardiology_procedures")
}

model CardiologyDevice {
  id                   String                 @id @default(cuid())
  patientId            String
  providerId           String?
  deviceType           String
  manufacturer         String?
  model                String?
  serialNumber         String?
  implantDate          DateTime?
  status               CardiologyDeviceStatus @default(ACTIVE)
  lastInterrogationDate DateTime?
  nextFollowUpDate     DateTime?
  batteryStatus        String?
  settings             String?                @db.Text
  notes                String?                @db.Text
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt

  patient              Patient                @relation(fields: [patientId], references: [id])
  provider             User?                  @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([implantDate])
  @@index([status])
  @@map("cardiology_devices")
}

model CardiologyMedicationOrder {
  id                String                   @id @default(cuid())
  patientId         String
  providerId        String?
  medicationName    String
  dose              String?
  route             CardiologyMedicationRoute?
  frequency         String?
  startDate         DateTime?
  endDate           DateTime?
  lastAdministeredAt DateTime?
  isActive          Boolean                  @default(true)
  indication        String?                  @db.Text
  notes             String?                  @db.Text
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt

  patient           Patient                  @relation(fields: [patientId], references: [id])
  provider          User?                    @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([isActive])
  @@map("cardiology_medication_orders")
}

model CardiologyLabResult {
  id               String   @id @default(cuid())
  patientId        String
  collectedAt      DateTime
  troponin         Float?
  bnp              Float?
  ntProBnp         Float?
  ckmb             Float?
  totalCholesterol Float?
  ldl              Float?
  hdl              Float?
  triglycerides    Float?
  crp              Float?
  inr              Float?
  notes            String?  @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  patient          Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([collectedAt])
  @@map("cardiology_lab_results")
}

model NephrologyVisit {
  id           String                 @id @default(cuid())
  patientId    String
  providerId   String
  status       NephrologyVisitStatus  @default(SCHEDULED)
  visitDate    DateTime
  reason       String?                @db.Text
  symptoms     String?                @db.Text
  ckdStage     CkdStage?
  egfr         Float?
  bpSystolic   Int?
  bpDiastolic  Int?
  diagnosis    String?                @db.Text
  assessment   String?                @db.Text
  plan         String?                @db.Text
  notes        String?                @db.Text
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  patient      Patient                @relation(fields: [patientId], references: [id])
  provider     User                   @relation(fields: [providerId], references: [id])
  imagingStudies NephrologyImaging[]
  biopsies     NephrologyBiopsy[]

  @@index([patientId])
  @@index([providerId])
  @@index([visitDate])
  @@index([status])
  @@index([ckdStage])
  @@map("nephrology_visits")
}

model NeurologyVisit {
  id           String               @id @default(cuid())
  patientId    String
  providerId   String
  status       NeurologyVisitStatus @default(SCHEDULED)
  visitDate    DateTime
  reason       String?              @db.Text
  symptoms     String?              @db.Text
  mentalStatus String?              @db.Text
  cranialNerves String?             @db.Text
  motorExam    String?              @db.Text
  sensoryExam  String?              @db.Text
  reflexes     String?              @db.Text
  coordination String?              @db.Text
  gait         String?              @db.Text
  speech       String?              @db.Text
  nihssScore   Int?
  gcsScore     Int?
  diagnosis    String?              @db.Text
  assessment   String?              @db.Text
  plan         String?              @db.Text
  notes        String?              @db.Text
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt

  patient      Patient              @relation(fields: [patientId], references: [id])
  provider     User                 @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([visitDate])
  @@index([status])
  @@map("neurology_visits")
}

model NephrologyLabResult {
  id               String   @id @default(cuid())
  patientId        String
  collectedAt      DateTime
  creatinine       Float?
  bun              Float?
  egfr             Float?
  potassium        Float?
  sodium           Float?
  chloride         Float?
  bicarbonate      Float?
  calcium          Float?
  phosphorus       Float?
  albumin          Float?
  hemoglobin       Float?
  pth              Float?
  vitaminD         Float?
  uricAcid         Float?
  urineProtein     Float?
  urineAlbumin     Float?
  urineCreatinine  Float?
  uacr             Float?
  upcr             Float?
  notes            String?  @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  patient          Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([collectedAt])
  @@map("nephrology_lab_results")
}

model NephrologyImaging {
  id           String                   @id @default(cuid())
  patientId    String
  providerId   String?
  visitId      String?
  status       NephrologyTestStatus     @default(ORDERED)
  performedAt  DateTime
  modality     NephrologyImagingModality
  studyType    String?
  findings     String?                  @db.Text
  impression   String?                  @db.Text
  notes        String?                  @db.Text
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt

  patient      Patient                  @relation(fields: [patientId], references: [id])
  provider     User?                    @relation(fields: [providerId], references: [id])
  visit        NephrologyVisit?         @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("nephrology_imaging_studies")
}

model NephrologyBiopsy {
  id               String                     @id @default(cuid())
  patientId        String
  providerId       String?
  visitId          String?
  status           NephrologyProcedureStatus  @default(SCHEDULED)
  performedAt      DateTime
  indication       String?                    @db.Text
  specimenType     String?
  pathologySummary String?                    @db.Text
  complications    String?                    @db.Text
  notes            String?                    @db.Text
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt

  patient          Patient                    @relation(fields: [patientId], references: [id])
  provider         User?                      @relation(fields: [providerId], references: [id])
  visit            NephrologyVisit?           @relation(fields: [visitId], references: [id], onDelete: SetNull)

  @@index([patientId])
  @@index([providerId])
  @@index([visitId])
  @@index([performedAt])
  @@index([status])
  @@map("nephrology_biopsies")
}

model NephrologyMedicationOrder {
  id                 String                    @id @default(cuid())
  patientId          String
  providerId         String?
  medicationName     String
  dose               String?
  route              NephrologyMedicationRoute?
  frequency          String?
  startDate          DateTime?
  endDate            DateTime?
  lastAdministeredAt DateTime?
  isActive           Boolean                   @default(true)
  indication         String?                   @db.Text
  notes              String?                   @db.Text
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt

  patient            Patient                   @relation(fields: [patientId], references: [id])
  provider           User?                     @relation(fields: [providerId], references: [id])

  @@index([patientId])
  @@index([providerId])
  @@index([isActive])
  @@map("nephrology_medication_orders")
}

model Encounter {
  id            String     @id @default(cuid())
  patientId     String
  providerId    String
  appointmentId String?    @unique
  createdById   String
  admissionId   String?
  status        EncounterStatus @default(OPEN)
  reasonForVisit String?
  diagnosis     String?    @db.Text
  assessment    String?    @db.Text
  plan          String?    @db.Text
  startTime     DateTime   @default(now())
  endTime       DateTime?
  notes         String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  patient    Patient   @relation(fields: [patientId], references: [id])
  provider   User      @relation("EncounterProvider", fields: [providerId], references: [id])
  appointment Appointment? @relation(fields: [appointmentId], references: [id])
  createdBy  User      @relation("EncounterCreatedBy", fields: [createdById], references: [id])
  admission Admission? @relation(fields: [admissionId], references: [id])
  orders    ClinicalOrder[]
  medicationOrders MedicationOrder[]
  invoices  Invoice[]

  @@index([patientId])
  @@index([providerId])
  @@index([admissionId])
  @@map("encounters")
}

model ClinicalOrder {
  id          String       @id @default(cuid())
  patientId   String
  providerId  String
  encounterId String?
  orderType   OrderType
  status      OrderStatus  @default(ORDERED)
  priority    OrderPriority @default(ROUTINE)
  orderedAt   DateTime     @default(now())
  orderName   String
  description String?      @db.Text
  notes       String?      @db.Text
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  patient     Patient      @relation(fields: [patientId], references: [id])
  provider    User         @relation(fields: [providerId], references: [id])
  encounter   Encounter?   @relation(fields: [encounterId], references: [id], onDelete: SetNull)
  results     ClinicalResult[]

  @@index([patientId])
  @@index([providerId])
  @@index([encounterId])
  @@index([orderType])
  @@index([status])
  @@map("clinical_orders")
}

model ClinicalResult {
  id             String       @id @default(cuid())
  orderId        String
  patientId      String
  reportedAt     DateTime     @default(now())
  resultName     String
  value          String?
  unit           String?
  referenceRange String?
  status         ResultStatus @default(PENDING)
  flag           ResultFlag   @default(NORMAL)
  notes          String?      @db.Text
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  order          ClinicalOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  patient        Patient       @relation(fields: [patientId], references: [id])

  @@index([orderId])
  @@index([patientId])
  @@index([reportedAt])
  @@index([status])
  @@index([flag])
  @@map("clinical_results")
}

model MedicationOrder {
  id                 String               @id @default(cuid())
  patientId          String
  providerId         String?
  encounterId        String?
  status             MedicationOrderStatus @default(ACTIVE)
  medicationName     String
  dose               String?
  route              MedicationRoute?
  frequency          String?
  startDate          DateTime?
  endDate            DateTime?
  lastAdministeredAt DateTime?
  indication         String?              @db.Text
  notes              String?              @db.Text
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt

  patient            Patient              @relation(fields: [patientId], references: [id])
  provider           User?                @relation(fields: [providerId], references: [id])
  encounter          Encounter?           @relation(fields: [encounterId], references: [id], onDelete: SetNull)
  administrations    MedicationAdministration[]

  @@index([patientId])
  @@index([providerId])
  @@index([encounterId])
  @@index([status])
  @@map("medication_orders")
}

model MedicationAdministration {
  id                 String                        @id @default(cuid())
  medicationOrderId  String
  patientId          String
  administeredById   String?
  administeredAt     DateTime                      @default(now())
  doseGiven          String?
  status             MedicationAdministrationStatus @default(GIVEN)
  notes              String?                       @db.Text
  createdAt          DateTime                      @default(now())
  updatedAt          DateTime                      @updatedAt

  medicationOrder    MedicationOrder               @relation(fields: [medicationOrderId], references: [id], onDelete: Cascade)
  patient            Patient                        @relation(fields: [patientId], references: [id])
  administeredBy     User?                          @relation(fields: [administeredById], references: [id])

  @@index([medicationOrderId])
  @@index([patientId])
  @@index([administeredById])
  @@index([administeredAt])
  @@index([status])
  @@map("medication_administrations")
}

model Ward {
  id           String   @id @default(cuid())
  name         String   @unique
  departmentId String?
  notes        String?  @db.Text
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  department   Department? @relation(fields: [departmentId], references: [id])
  beds         Bed[]
  admissions   Admission[]

  @@map("wards")
}

model Bed {
  id         String   @id @default(cuid())
  wardId     String
  roomNumber String?
  bedLabel   String
  status     BedStatus @default(AVAILABLE)
  isActive   Boolean  @default(true)
  notes      String?  @db.Text
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  ward       Ward     @relation(fields: [wardId], references: [id])
  admissions Admission[]

  @@index([wardId])
  @@index([status])
  @@map("beds")
}

model Admission {
  id           String          @id @default(cuid())
  patientId    String
  providerId   String
  wardId       String?
  bedId        String?
  departmentId String?
  status       AdmissionStatus @default(ADMITTED)
  admitDate    DateTime        @default(now())
  dischargeDate DateTime?
  reason       String?         @db.Text
  diagnosis    String?         @db.Text
  notes        String?         @db.Text
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  patient      Patient         @relation(fields: [patientId], references: [id])
  provider     User            @relation(fields: [providerId], references: [id])
  ward         Ward?           @relation(fields: [wardId], references: [id])
  bed          Bed?            @relation(fields: [bedId], references: [id])
  department   Department?     @relation(fields: [departmentId], references: [id])
  encounters   Encounter[]

  @@index([patientId])
  @@index([providerId])
  @@index([status])
  @@index([admitDate])
  @@map("admissions")
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique
  patientId     String
  encounterId   String?
  status        InvoiceStatus @default(DRAFT)
  totalAmount   Float         @default(0)
  dueDate       DateTime?
  notes         String?       @db.Text
  createdById   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  patient       Patient       @relation(fields: [patientId], references: [id])
  encounter     Encounter?    @relation(fields: [encounterId], references: [id], onDelete: SetNull)
  createdBy     User?         @relation(fields: [createdById], references: [id])
  items         InvoiceItem[]
  payments      Payment[]
  claims        Claim[]

  @@index([patientId])
  @@index([encounterId])
  @@index([status])
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  description String
  quantity    Int      @default(1)
  unitPrice   Float
  totalPrice  Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Payment {
  id           String       @id @default(cuid())
  invoiceId    String
  patientId    String
  amount       Float
  method       PaymentMethod
  paidAt       DateTime     @default(now())
  reference    String?
  receivedById String?
  notes        String?      @db.Text
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  invoice      Invoice      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  patient      Patient      @relation(fields: [patientId], references: [id])
  receivedBy   User?        @relation(fields: [receivedById], references: [id])

  @@index([invoiceId])
  @@index([patientId])
  @@index([paidAt])
  @@index([method])
  @@map("payments")
}

model Claim {
  id          String      @id @default(cuid())
  invoiceId   String
  patientId   String
  payerName   String
  status      ClaimStatus @default(DRAFT)
  submittedAt DateTime?
  resolvedAt  DateTime?
  notes       String?     @db.Text
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  invoice     Invoice     @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  patient     Patient     @relation(fields: [patientId], references: [id])

  @@index([invoiceId])
  @@index([patientId])
  @@index([status])
  @@map("claims")
}
